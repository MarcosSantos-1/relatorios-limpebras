(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[1271],{63:(e,t,r)=>{"use strict";var a=r(7260);r.o(a,"usePathname")&&r.d(t,{usePathname:function(){return a.usePathname}}),r.o(a,"useRouter")&&r.d(t,{useRouter:function(){return a.useRouter}})},4589:(e,t,r)=>{"use strict";r.d(t,{K:()=>n});var a=r(5155),o=r(8209),s=r(63),i=r(2115);function n(e){let{children:t,requiredRole:r="user",fallbackPath:n="/relatorios"}=e,{isAuthenticated:l,isAdmin:c,isLoading:d}=(0,o.A)(),u=(0,s.useRouter)();if((0,i.useEffect)(()=>{if(!d&&l){let e=!1;switch(r){case"host":case"admin":e=c;break;case"user":e=!0}e||u.push(n)}},[l,c,d,r,n,u]),d)return(0,a.jsx)("div",{className:"min-h-screen bg-gradient-to-br from-slate-50 to-blue-50 dark:from-slate-900 dark:to-blue-900 flex items-center justify-center",children:(0,a.jsxs)("div",{className:"text-center",children:[(0,a.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto mb-4"}),(0,a.jsx)("p",{className:"text-slate-600 dark:text-slate-400",children:"Verificando permiss\xf5es..."})]})});if(!l)return null;let m=!1;switch(r){case"host":case"admin":m=c;break;case"user":m=!0}return m?(0,a.jsx)(a.Fragment,{children:t}):(0,a.jsx)("div",{className:"min-h-screen bg-gradient-to-br from-slate-50 to-blue-50 dark:from-slate-900 dark:to-blue-900 flex items-center justify-center",children:(0,a.jsxs)("div",{className:"text-center bg-white dark:bg-slate-800 p-8 rounded-xl shadow-lg",children:[(0,a.jsx)("div",{className:"text-red-500 text-6xl mb-4",children:"\uD83D\uDEAB"}),(0,a.jsx)("h1",{className:"text-2xl font-bold text-slate-800 dark:text-slate-200 mb-2",children:"Acesso Negado"}),(0,a.jsx)("p",{className:"text-slate-600 dark:text-slate-400 mb-6",children:"Voc\xea n\xe3o tem permiss\xe3o para acessar esta p\xe1gina."}),(0,a.jsx)("button",{onClick:()=>u.push(n),className:"bg-blue-600 hover:bg-blue-700 text-white px-6 py-3 rounded-lg font-semibold transition-colors duration-200",children:"Voltar ao In\xedcio"})]})})}},6187:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>d});var a=r(5155),o=r(2115),s=r(3372),i=r(9675),n=r(4589),l=r(4744);let c={ST:["Pra\xe7a Herois da Forca Expedicionaria Brasileira / Opera\xe7\xe3o Baixas Temperaturas","Pra\xe7a Herois da Forca Expedicionaria Brasileira / Opera\xe7\xe3o Altas Temperaturas"],MG:["Pra\xe7a Novo Mundo / Opera\xe7\xe3o Baixas Temperaturas","Pra\xe7a Novo Mundo / Opera\xe7\xe3o Altas Temperaturas"],SP:[],CV:[],JT:[]};function d(){var e;let[t]=(0,o.useState)("Eventos"),[r,d]=(0,o.useState)("ST"),[u,m]=(0,o.useState)(""),[x,h]=(0,o.useState)(""),[g,p]=(0,o.useState)("predefinido"),[f,b]=(0,o.useState)([]),[v,j]=(0,o.useState)(!1);async function y(){if(0===f.length)return void l.oR.error("Por favor, adicione pelo menos uma data.");let e="predefinido"===g?u:x;if(!e.trim())return void l.oR.error("Por favor, selecione ou digite o nome do evento.");if(f.filter(e=>!e.data||0===e.fotos.length).length>0)return void l.oR.error("Todas as datas devem ter uma data selecionada e pelo menos uma foto.");j(!0);try{let a=Date.now();for(let o of f){let n={id:(0,i.A)(),tipoServico:"EVENTOS",assunto:t,dataInicio:o.data,dataFim:o.data,sub:r,local:e.split(" / ")[0]||e,descricao:"Evento",nomeEvento:e,fotos:o.fotos.map(t=>({url:t,descricao:e})),createdAt:a,updatedAt:a};await (0,s.wt)(n)}l.oR.success("".concat(f.length," relat\xf3rio(s) de evento criado(s) com sucesso!")),window.location.href="/relatorios"}catch(a){console.error("Erro ao salvar relat\xf3rios:",a),l.oR.error("Erro ao salvar. Tentando limpar relat\xf3rios antigos..."),await (0,s.gI)();try{for(let a of f){let o={id:(0,i.A)(),tipoServico:"EVENTOS",assunto:t,dataInicio:a.data,dataFim:a.data,sub:r,local:e.split(" / ")[0]||e,descricao:"Evento",nomeEvento:e,fotos:a.fotos.map(t=>({url:t,descricao:e})),createdAt:Date.now(),updatedAt:Date.now()};await (0,s.wt)(o)}l.oR.success("Relat\xf3rios salvos com sucesso ap\xf3s limpeza!"),window.location.href="/relatorios"}catch(e){l.oR.error("Erro persistente. Por favor, tente novamente.")}}finally{j(!1)}}return(0,a.jsx)(n.K,{requiredRole:"admin",children:(0,a.jsx)("div",{className:"min-h-screen bg-zinc-50 dark:bg-zinc-900 py-8",children:(0,a.jsxs)("div",{className:"max-w-6xl mx-auto px-4 sm:px-6 lg:px-8",children:[(0,a.jsxs)("div",{className:"mb-8",children:[(0,a.jsx)("h1",{className:"text-3xl font-bold text-zinc-900 dark:text-zinc-100",children:"Novo Relat\xf3rio - Eventos"}),(0,a.jsx)("p",{className:"mt-2 text-zinc-600 dark:text-zinc-400",children:"Cadastre eventos com fotos por data"})]}),(0,a.jsxs)("div",{className:"bg-white dark:bg-zinc-800 rounded-xl shadow-lg p-6 space-y-6",children:[(0,a.jsx)("h2",{className:"text-xl font-semibold text-zinc-900 dark:text-zinc-100 mb-4",children:"Dados do Evento"}),(0,a.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-zinc-700 dark:text-zinc-300 mb-2",children:"Sub-regi\xe3o *"}),(0,a.jsxs)("select",{value:r,onChange:e=>{d(e.target.value),m("")},className:"w-full px-3 py-2 border border-zinc-300 dark:border-zinc-600 rounded-lg bg-white dark:bg-zinc-700 text-zinc-900 dark:text-zinc-100 focus:ring-2 focus:ring-green-500 focus:border-transparent",children:[(0,a.jsx)("option",{value:"ST",children:"Santana / Tucuruvi"}),(0,a.jsx)("option",{value:"MG",children:"Vila Maria / Vila Guilherme"})]})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-zinc-700 dark:text-zinc-300 mb-2",children:"Tipo de Evento *"}),(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsxs)("label",{className:"flex items-center",children:[(0,a.jsx)("input",{type:"radio",name:"tipoEvento",value:"predefinido",checked:"predefinido"===g,onChange:()=>p("predefinido"),className:"mr-2"}),(0,a.jsx)("span",{className:"text-zinc-700 dark:text-zinc-300",children:"Evento Predefinido"})]}),(0,a.jsxs)("label",{className:"flex items-center",children:[(0,a.jsx)("input",{type:"radio",name:"tipoEvento",value:"outros",checked:"outros"===g,onChange:()=>p("outros"),className:"mr-2"}),(0,a.jsx)("span",{className:"text-zinc-700 dark:text-zinc-300",children:"Outros Eventos"})]})]})]})]}),"predefinido"===g?(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-zinc-700 dark:text-zinc-300 mb-2",children:"Evento Predefinido *"}),(0,a.jsxs)("select",{value:u,onChange:e=>m(e.target.value),className:"w-full px-3 py-2 border border-zinc-300 dark:border-zinc-600 rounded-lg bg-white dark:bg-zinc-700 text-zinc-900 dark:text-zinc-100 focus:ring-2 focus:ring-green-500 focus:border-transparent",children:[(0,a.jsx)("option",{value:"",children:"Selecione um evento"}),null==(e=c[r])?void 0:e.map(e=>(0,a.jsx)("option",{value:e,children:e},e))]})]}):(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-zinc-700 dark:text-zinc-300 mb-2",children:"Nome do Evento *"}),(0,a.jsx)("input",{type:"text",value:x,onChange:e=>h(e.target.value),placeholder:"Digite o nome do evento",className:"w-full px-3 py-2 border border-zinc-300 dark:border-zinc-600 rounded-lg bg-white dark:bg-zinc-700 text-zinc-900 dark:text-zinc-100 focus:ring-2 focus:ring-green-500 focus:border-transparent"})]}),(0,a.jsxs)("div",{children:[(0,a.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,a.jsxs)("h3",{className:"text-lg font-medium text-zinc-900 dark:text-zinc-100",children:["Datas do Evento (",f.length,")"]}),(0,a.jsx)("button",{onClick:()=>{b([...f,{data:"",fotos:[]}])},className:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors",children:"➕ Adicionar Data"})]}),0===f.length?(0,a.jsx)("div",{className:"text-center py-8 text-zinc-500 dark:text-zinc-400",children:'Nenhuma data adicionada ainda. Clique em "Adicionar Data" para come\xe7ar.'}):(0,a.jsx)("div",{className:"space-y-4",children:f.map((e,t)=>(0,a.jsxs)("div",{className:"border border-zinc-200 dark:border-zinc-700 rounded-lg p-4",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between mb-3",children:[(0,a.jsxs)("h4",{className:"font-medium text-zinc-900 dark:text-zinc-100",children:["Data ",t+1]}),(0,a.jsx)("button",{onClick:()=>{b(f.filter((e,r)=>r!==t))},className:"px-3 py-1 bg-red-600 text-white rounded hover:bg-red-700 transition-colors text-sm",children:"\uD83D\uDDD1️ Remover"})]}),(0,a.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 mb-4",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-zinc-700 dark:text-zinc-300 mb-2",children:"Data *"}),(0,a.jsx)("input",{type:"date",value:e.data,onChange:e=>((e,t)=>{let r=[...f];r[e].data=t,b(r)})(t,e.target.value),className:"w-full px-3 py-2 border border-zinc-300 dark:border-zinc-600 rounded-lg bg-white dark:bg-zinc-700 text-zinc-900 dark:text-zinc-100 focus:ring-2 focus:ring-green-500 focus:border-transparent"})]}),(0,a.jsx)("div",{className:"flex items-end",children:(0,a.jsx)("button",{onClick:()=>(e=>{let t=document.createElement("input");t.type="file",t.accept="image/*",t.multiple=!0,t.onchange=t=>{let r=t.target.files;r&&Array.from(r).forEach(t=>{!function(e,t){if(e.size>0xa00000)return l.oR.error("Arquivo muito grande. M\xe1ximo 10MB.");(function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:800,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:.8;return new Promise(a=>{let o=document.createElement("canvas"),s=o.getContext("2d"),i=new Image;i.onload=()=>{let{width:e,height:n}=i;e>t&&(n=n*t/e,e=t),o.width=e,o.height=n,null==s||s.drawImage(i,0,0,e,n),a(o.toDataURL("image/jpeg",r))},i.src=URL.createObjectURL(e)})})(e).then(t)}(t,t=>{let r=[...f];r[e].fotos.push(t),b(r)})})},t.click()})(t),className:"w-full px-3 py-2 bg-green-600 text-white rounded hover:bg-green-700 transition-colors text-sm",children:"\uD83D\uDCF8 Adicionar Fotos"})})]}),e.fotos.length>0?(0,a.jsx)("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-3",children:e.fotos.map((e,r)=>(0,a.jsxs)("div",{className:"relative",children:[(0,a.jsx)("img",{src:e,alt:"Foto ".concat(r+1),className:"w-full h-24 object-cover rounded border border-zinc-300 dark:border-zinc-600"}),(0,a.jsx)("button",{onClick:()=>((e,t)=>{let r=[...f];r[e].fotos.splice(t,1),b(r)})(t,r),className:"absolute -top-1 -right-1 bg-red-600 hover:bg-red-500 text-white rounded-full w-5 h-5 flex items-center justify-center text-xs",children:"\xd7"})]},r))}):(0,a.jsx)("div",{className:"text-center py-4 text-zinc-500 dark:text-zinc-400 text-sm",children:"Nenhuma foto adicionada para esta data"})]},t))})]}),(0,a.jsxs)("div",{className:"flex gap-4 pt-6",children:[(0,a.jsx)("button",{type:"button",onClick:()=>window.history.back(),className:"px-6 py-2 border border-zinc-300 dark:border-zinc-600 text-zinc-700 dark:text-zinc-300 rounded-lg hover:bg-zinc-50 dark:hover:bg-zinc-700 transition-colors",children:"Cancelar"}),(0,a.jsx)("button",{type:"button",onClick:y,disabled:v,className:"px-6 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 disabled:opacity-50 disabled:cursor-not-allowed transition-colors",children:v?"Salvando...":"Salvar ".concat(f.length," Relat\xf3rio(s)")})]})]})]})})})}},6724:(e,t,r)=>{Promise.resolve().then(r.bind(r,6187))},8209:(e,t,r)=>{"use strict";r.d(t,{A:()=>i,Y:()=>n});var a=r(2115),o=r(3361);let s={"marcos.silva":"marcos.silva@limpebras.com",admin:"admin@test.com","admin@test.com":"admin@test.com",usuario1:"usuario1@limpebras.com",usuario2:"usuario2@limpebras.com"};function i(){let[e,t]=(0,a.useState)({isAuthenticated:!1,user:null,isLoading:!0,login:async()=>!1,logout:()=>{},isAdmin:!1});(0,a.useEffect)(()=>{localStorage.getItem("auth_token")?(o.y1.initToken(),o.y1.getProfile().then(e=>{t(t=>({...t,isAuthenticated:!0,user:{id:e.id,nome:e.nome,email:e.email,username:e.email.split("@")[0],role:e.role,created_at:e.created_at},isLoading:!1,isAdmin:"admin"===e.role}))}).catch(e=>{console.error("Token inv\xe1lido:",e),localStorage.removeItem("auth_token"),t(e=>({...e,isAuthenticated:!1,user:null,isLoading:!1,isAdmin:!1}))})):t(e=>({...e,isAuthenticated:!1,user:null,isLoading:!1,isAdmin:!1}))},[]);let r=async(e,r)=>{try{let a=s[e]||e,i=await o.y1.login(a,r);if(i.token&&i.user)return t(t=>({...t,isAuthenticated:!0,user:{id:i.user.id,nome:i.user.nome,email:i.user.email,username:e,role:i.user.role},isLoading:!1,isAdmin:"admin"===i.user.role})),console.log("Login successful, user authenticated:",i.user),!0;return console.log("Login failed - invalid response"),!1}catch(e){return console.error("Erro no login:",e),!1}};return{...e,login:r,logout:()=>{o.y1.logout(),t(e=>({...e,isAuthenticated:!1,user:null,isLoading:!1,isAdmin:!1}))},isAdmin:e.isAdmin}}function n(){let[e,t]=(0,a.useState)([]),[r,s]=(0,a.useState)(!1),i=async()=>{try{s(!0),t([])}catch(e){console.error("Erro ao carregar usu\xe1rios:",e)}finally{s(!1)}};return(0,a.useEffect)(()=>{i()},[]),{users:e,loading:r,addUser:async e=>{try{let t=await o.y1.register(e);return await i(),t.user}catch(e){throw console.error("Erro ao adicionar usu\xe1rio:",e),e}},updateUser:async(e,t)=>{try{await o.y1.updateProfile(t),await i()}catch(e){throw console.error("Erro ao atualizar usu\xe1rio:",e),e}},deleteUser:async e=>{try{await i()}catch(e){throw console.error("Erro ao deletar usu\xe1rio:",e),e}},toggleUserStatus:async e=>{try{await i()}catch(e){throw console.error("Erro ao alterar status do usu\xe1rio:",e),e}},refreshUsers:i}}},9675:(e,t,r)=>{"use strict";let a;r.d(t,{A:()=>n});let o={randomUUID:"undefined"!=typeof crypto&&crypto.randomUUID&&crypto.randomUUID.bind(crypto)},s=new Uint8Array(16),i=[];for(let e=0;e<256;++e)i.push((e+256).toString(16).slice(1));let n=function(e,t,r){if(o.randomUUID&&!t&&!e)return o.randomUUID();var n=e,l=r;let c=(n=n||{}).random??n.rng?.()??function(){if(!a){if("undefined"==typeof crypto||!crypto.getRandomValues)throw Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");a=crypto.getRandomValues.bind(crypto)}return a(s)}();if(c.length<16)throw Error("Random bytes length must be >= 16");if(c[6]=15&c[6]|64,c[8]=63&c[8]|128,t){if((l=l||0)<0||l+16>t.length)throw RangeError(`UUID byte range ${l}:${l+15} is out of buffer bounds`);for(let e=0;e<16;++e)t[l+e]=c[e];return t}return function(e,t=0){return(i[e[t+0]]+i[e[t+1]]+i[e[t+2]]+i[e[t+3]]+"-"+i[e[t+4]]+i[e[t+5]]+"-"+i[e[t+6]]+i[e[t+7]]+"-"+i[e[t+8]]+i[e[t+9]]+"-"+i[e[t+10]]+i[e[t+11]]+i[e[t+12]]+i[e[t+13]]+i[e[t+14]]+i[e[t+15]]).toLowerCase()}(c)}}},e=>{e.O(0,[4744,3372,8441,1255,7358],()=>e(e.s=6724)),_N_E=e.O()}]);