(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[9513],{63:(e,r,t)=>{"use strict";var a=t(7260);t.o(a,"usePathname")&&t.d(r,{usePathname:function(){return a.usePathname}}),t.o(a,"useRouter")&&t.d(r,{useRouter:function(){return a.useRouter}})},312:(e,r,t)=>{Promise.resolve().then(t.bind(t,4053))},4053:(e,r,t)=>{"use strict";t.r(r),t.d(r,{default:()=>c});var a=t(5155),o=t(2115),i=t(3372),s=t(9675),n=t(4589),l=t(4744);function c(){let[e]=(0,o.useState)("Feiras"),[r,t]=(0,o.useState)(null),[c,d]=(0,o.useState)(null),[u,m]=(0,o.useState)("SP"),[g,h]=(0,o.useState)(""),[x,b]=(0,o.useState)(""),[f,p]=(0,o.useState)([]),[v,y]=(0,o.useState)(!1);async function w(){if(!r)return void l.oR.error("Por favor, selecione a data de in\xedcio.");if(!c)return void l.oR.error("Por favor, selecione a data de fim.");if(!g.trim())return void l.oR.error("Por favor, informe o local.");if(0===f.length)return void l.oR.error("Por favor, adicione pelo menos uma foto.");y(!0);try{let t=Date.now(),a=(0,s.A)(),o=r.toISOString().split("T")[0],n=c.toISOString().split("T")[0],d={id:a,title:e,tipoServico:"FEIRAS",assunto:e,dataInicio:o,dataTermino:n,sub:u,local:g,descricao:x,fotos:f.map(r=>({url:r,descricao:e})),createdAt:t,updatedAt:t};await (0,i.wt)(d),l.oR.success("Relat\xf3rio salvo com sucesso!"),window.location.href="/relatorios"}catch(t){console.error("Erro ao salvar relat\xf3rio:",t),l.oR.error("Erro ao salvar. Tentando limpar relat\xf3rios antigos..."),await (0,i.gI)();try{let t=Date.now(),a=(0,s.A)(),o=r.toISOString().split("T")[0],n=c.toISOString().split("T")[0],d={id:a,title:e,tipoServico:"FEIRAS",assunto:e,dataInicio:o,dataTermino:n,sub:u,local:g,descricao:x,fotos:f.map(r=>({url:r,descricao:e})),createdAt:t,updatedAt:t};await (0,i.wt)(d),l.oR.success("Relat\xf3rio salvo com sucesso!"),window.location.href="/relatorios"}catch(e){l.oR.error("Erro persistente. Por favor, tente novamente com menos fotos.")}}finally{y(!1)}}return(0,a.jsx)(n.K,{requiredRole:"admin",children:(0,a.jsx)("div",{className:"min-h-screen bg-zinc-50 dark:bg-zinc-900 py-8",children:(0,a.jsxs)("div",{className:"max-w-4xl mx-auto px-4 sm:px-6 lg:px-8",children:[(0,a.jsxs)("div",{className:"mb-8",children:[(0,a.jsx)("h1",{className:"text-3xl font-bold text-zinc-900 dark:text-zinc-100",children:"Novo Relat\xf3rio - Feiras"}),(0,a.jsx)("p",{className:"mt-2 text-zinc-600 dark:text-zinc-400",children:"Cadastre um novo relat\xf3rio de feiras"})]}),(0,a.jsxs)("div",{className:"bg-white dark:bg-zinc-800 rounded-xl shadow-lg p-6 space-y-6",children:[(0,a.jsx)("h2",{className:"text-xl font-semibold text-zinc-900 dark:text-zinc-100 mb-4",children:"Dados do Servi\xe7o"}),(0,a.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-zinc-700 dark:text-zinc-300 mb-2",children:"Data de In\xedcio *"}),(0,a.jsx)("input",{type:"date",value:r?r.toISOString().split("T")[0]:"",onChange:e=>t(e.target.value?new Date(e.target.value):null),className:"w-full px-3 py-2 border border-zinc-300 dark:border-zinc-600 rounded-lg bg-white dark:bg-zinc-700 text-zinc-900 dark:text-zinc-100 focus:ring-2 focus:ring-green-500 focus:border-transparent"})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-zinc-700 dark:text-zinc-300 mb-2",children:"Data de Fim *"}),(0,a.jsx)("input",{type:"date",value:c?c.toISOString().split("T")[0]:"",onChange:e=>d(e.target.value?new Date(e.target.value):null),className:"w-full px-3 py-2 border border-zinc-300 dark:border-zinc-600 rounded-lg bg-white dark:bg-zinc-700 text-zinc-900 dark:text-zinc-100 focus:ring-2 focus:ring-green-500 focus:border-transparent"})]})]}),(0,a.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-zinc-700 dark:text-zinc-300 mb-2",children:"Sub-regi\xe3o *"}),(0,a.jsxs)("select",{value:u,onChange:e=>m(e.target.value),className:"w-full px-3 py-2 border border-zinc-300 dark:border-zinc-600 rounded-lg bg-white dark:bg-zinc-700 text-zinc-900 dark:text-zinc-100 focus:ring-2 focus:ring-green-500 focus:border-transparent",children:[(0,a.jsx)("option",{value:"SP",children:"S\xe3o Paulo"}),(0,a.jsx)("option",{value:"CV",children:"Casa Verde / Lim\xe3o / Cachoeirinha"}),(0,a.jsx)("option",{value:"JT",children:"Ja\xe7an\xe3 / Trememb\xe9"}),(0,a.jsx)("option",{value:"MG",children:"Vila Maria / Vila Guilherme"}),(0,a.jsx)("option",{value:"ST",children:"Santana / Tucuruvi"})]})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-zinc-700 dark:text-zinc-300 mb-2",children:"Local *"}),(0,a.jsx)("input",{type:"text",value:g,onChange:e=>h(e.target.value),placeholder:"Ex: Pra\xe7a da Rep\xfablica",className:"w-full px-3 py-2 border border-zinc-300 dark:border-zinc-600 rounded-lg bg-white dark:bg-zinc-700 text-zinc-900 dark:text-zinc-100 focus:ring-2 focus:ring-green-500 focus:border-transparent"})]})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-zinc-700 dark:text-zinc-300 mb-2",children:"Descri\xe7\xe3o"}),(0,a.jsx)("textarea",{value:x,onChange:e=>b(e.target.value),placeholder:"Descreva os detalhes da feira...",rows:4,className:"w-full px-3 py-2 border border-zinc-300 dark:border-zinc-600 rounded-lg bg-white dark:bg-zinc-700 text-zinc-900 dark:text-zinc-100 focus:ring-2 focus:ring-green-500 focus:border-transparent"})]}),(0,a.jsxs)("div",{children:[(0,a.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,a.jsxs)("h3",{className:"text-lg font-medium text-zinc-900 dark:text-zinc-100",children:["Fotos (",f.length,")"]}),(0,a.jsx)("button",{type:"button",onClick:function(){let e=document.createElement("input");e.type="file",e.accept="image/*",e.multiple=!0,e.onchange=e=>{let r=e.target.files;r&&Array.from(r).forEach(e=>{!function(e,r){if(e.size>0xa00000)return l.oR.error("Arquivo muito grande. M\xe1ximo 10MB.");(function(e){let r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:800,t=arguments.length>2&&void 0!==arguments[2]?arguments[2]:.8;return new Promise(a=>{let o=document.createElement("canvas"),i=o.getContext("2d"),s=new Image;s.onload=()=>{let{width:e,height:n}=s;e>r&&(n=n*r/e,e=r),o.width=e,o.height=n,null==i||i.drawImage(s,0,0,e,n),a(o.toDataURL("image/jpeg",t))},s.src=URL.createObjectURL(e)})})(e).then(r)}(e,e=>{p(r=>[...r,e])})})},e.click()},className:"px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 transition-colors",children:"Adicionar Fotos"})]}),f.length>0&&(0,a.jsx)("div",{className:"grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-4",children:f.map((e,r)=>(0,a.jsxs)("div",{className:"relative group",children:[(0,a.jsx)("img",{src:e,alt:"Foto ".concat(r+1),className:"w-full h-32 object-cover rounded-lg"}),(0,a.jsx)("button",{type:"button",onClick:()=>{p(e=>e.filter((e,t)=>t!==r))},className:"absolute top-2 right-2 bg-red-600 text-white rounded-full w-6 h-6 flex items-center justify-center text-sm hover:bg-red-700 transition-colors",children:"\xd7"})]},r))})]}),(0,a.jsxs)("div",{className:"flex gap-4 pt-6",children:[(0,a.jsx)("button",{type:"button",onClick:()=>window.history.back(),className:"px-6 py-2 border border-zinc-300 dark:border-zinc-600 text-zinc-700 dark:text-zinc-300 rounded-lg hover:bg-zinc-50 dark:hover:bg-zinc-700 transition-colors",children:"Cancelar"}),(0,a.jsx)("button",{type:"button",onClick:w,disabled:v,className:"px-6 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 disabled:opacity-50 disabled:cursor-not-allowed transition-colors",children:v?"Salvando...":"Salvar Relat\xf3rio"})]})]})]})})})}},4589:(e,r,t)=>{"use strict";t.d(r,{K:()=>n});var a=t(5155),o=t(8209),i=t(63),s=t(2115);function n(e){let{children:r,requiredRole:t="user",fallbackPath:n="/relatorios"}=e,{isAuthenticated:l,isAdmin:c,isLoading:d}=(0,o.A)(),u=(0,i.useRouter)();if((0,s.useEffect)(()=>{if(!d&&l){let e=!1;switch(t){case"host":case"admin":e=c;break;case"user":e=!0}e||u.push(n)}},[l,c,d,t,n,u]),d)return(0,a.jsx)("div",{className:"min-h-screen bg-gradient-to-br from-slate-50 to-blue-50 dark:from-slate-900 dark:to-blue-900 flex items-center justify-center",children:(0,a.jsxs)("div",{className:"text-center",children:[(0,a.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto mb-4"}),(0,a.jsx)("p",{className:"text-slate-600 dark:text-slate-400",children:"Verificando permiss\xf5es..."})]})});if(!l)return null;let m=!1;switch(t){case"host":case"admin":m=c;break;case"user":m=!0}return m?(0,a.jsx)(a.Fragment,{children:r}):(0,a.jsx)("div",{className:"min-h-screen bg-gradient-to-br from-slate-50 to-blue-50 dark:from-slate-900 dark:to-blue-900 flex items-center justify-center",children:(0,a.jsxs)("div",{className:"text-center bg-white dark:bg-slate-800 p-8 rounded-xl shadow-lg",children:[(0,a.jsx)("div",{className:"text-red-500 text-6xl mb-4",children:"\uD83D\uDEAB"}),(0,a.jsx)("h1",{className:"text-2xl font-bold text-slate-800 dark:text-slate-200 mb-2",children:"Acesso Negado"}),(0,a.jsx)("p",{className:"text-slate-600 dark:text-slate-400 mb-6",children:"Voc\xea n\xe3o tem permiss\xe3o para acessar esta p\xe1gina."}),(0,a.jsx)("button",{onClick:()=>u.push(n),className:"bg-blue-600 hover:bg-blue-700 text-white px-6 py-3 rounded-lg font-semibold transition-colors duration-200",children:"Voltar ao In\xedcio"})]})})}},8209:(e,r,t)=>{"use strict";t.d(r,{A:()=>s,Y:()=>n});var a=t(2115),o=t(3361);let i={"marcos.silva":"marcos.silva@limpebras.com",admin:"admin@test.com","admin@test.com":"admin@test.com",usuario1:"usuario1@limpebras.com",usuario2:"usuario2@limpebras.com"};function s(){let[e,r]=(0,a.useState)({isAuthenticated:!1,user:null,isLoading:!0,login:async()=>!1,logout:()=>{},isAdmin:!1});(0,a.useEffect)(()=>{localStorage.getItem("auth_token")?(o.y1.initToken(),o.y1.getProfile().then(e=>{r(r=>({...r,isAuthenticated:!0,user:{id:e.id,nome:e.nome,email:e.email,username:e.email.split("@")[0],role:e.role,created_at:e.created_at},isLoading:!1,isAdmin:"admin"===e.role}))}).catch(e=>{console.error("Token inv\xe1lido:",e),localStorage.removeItem("auth_token"),r(e=>({...e,isAuthenticated:!1,user:null,isLoading:!1,isAdmin:!1}))})):r(e=>({...e,isAuthenticated:!1,user:null,isLoading:!1,isAdmin:!1}))},[]);let t=async(e,t)=>{try{let a=i[e]||e,s=await o.y1.login(a,t);if(s.token&&s.user)return r(r=>({...r,isAuthenticated:!0,user:{id:s.user.id,nome:s.user.nome,email:s.user.email,username:e,role:s.user.role},isLoading:!1,isAdmin:"admin"===s.user.role})),console.log("Login successful, user authenticated:",s.user),!0;return console.log("Login failed - invalid response"),!1}catch(e){return console.error("Erro no login:",e),!1}};return{...e,login:t,logout:()=>{o.y1.logout(),r(e=>({...e,isAuthenticated:!1,user:null,isLoading:!1,isAdmin:!1}))},isAdmin:e.isAdmin}}function n(){let[e,r]=(0,a.useState)([]),[t,i]=(0,a.useState)(!1),s=async()=>{try{i(!0),r([])}catch(e){console.error("Erro ao carregar usu\xe1rios:",e)}finally{i(!1)}};return(0,a.useEffect)(()=>{s()},[]),{users:e,loading:t,addUser:async e=>{try{let r=await o.y1.register(e);return await s(),r.user}catch(e){throw console.error("Erro ao adicionar usu\xe1rio:",e),e}},updateUser:async(e,r)=>{try{await o.y1.updateProfile(r),await s()}catch(e){throw console.error("Erro ao atualizar usu\xe1rio:",e),e}},deleteUser:async e=>{try{await s()}catch(e){throw console.error("Erro ao deletar usu\xe1rio:",e),e}},toggleUserStatus:async e=>{try{await s()}catch(e){throw console.error("Erro ao alterar status do usu\xe1rio:",e),e}},refreshUsers:s}}},9675:(e,r,t)=>{"use strict";let a;t.d(r,{A:()=>n});let o={randomUUID:"undefined"!=typeof crypto&&crypto.randomUUID&&crypto.randomUUID.bind(crypto)},i=new Uint8Array(16),s=[];for(let e=0;e<256;++e)s.push((e+256).toString(16).slice(1));let n=function(e,r,t){if(o.randomUUID&&!r&&!e)return o.randomUUID();var n=e,l=t;let c=(n=n||{}).random??n.rng?.()??function(){if(!a){if("undefined"==typeof crypto||!crypto.getRandomValues)throw Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");a=crypto.getRandomValues.bind(crypto)}return a(i)}();if(c.length<16)throw Error("Random bytes length must be >= 16");if(c[6]=15&c[6]|64,c[8]=63&c[8]|128,r){if((l=l||0)<0||l+16>r.length)throw RangeError(`UUID byte range ${l}:${l+15} is out of buffer bounds`);for(let e=0;e<16;++e)r[l+e]=c[e];return r}return function(e,r=0){return(s[e[r+0]]+s[e[r+1]]+s[e[r+2]]+s[e[r+3]]+"-"+s[e[r+4]]+s[e[r+5]]+"-"+s[e[r+6]]+s[e[r+7]]+"-"+s[e[r+8]]+s[e[r+9]]+"-"+s[e[r+10]]+s[e[r+11]]+s[e[r+12]]+s[e[r+13]]+s[e[r+14]]+s[e[r+15]]).toLowerCase()}(c)}}},e=>{e.O(0,[4744,3372,8441,1255,7358],()=>e(e.s=312)),_N_E=e.O()}]);