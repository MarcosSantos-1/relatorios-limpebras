(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[4255],{674:(e,r,a)=>{Promise.resolve().then(a.bind(a,4591))},4389:(e,r,a)=>{"use strict";a.d(r,{A:()=>c});var t=a(5155),o=a(8661),i=a.n(o),s=a(2115),n=a(740);function c(e){let{selectedDate:r,onChange:a,placeholder:o="Selecione uma data",className:c=""}=e,[d,l]=(0,s.useState)(!1);return(0,t.jsxs)("div",{className:"jsx-e84ae2c801487fae "+"relative ".concat(c),children:[(0,t.jsx)(n.Ay,{selected:r,onChange:e=>{a(e),l(!1)},onCalendarOpen:()=>l(!0),onCalendarClose:()=>l(!1),open:d,placeholderText:o,dateFormat:"dd/MM/yyyy",showPopperArrow:!1,popperClassName:"custom-datepicker-popper",className:"w-full px-3 py-2 rounded-lg border border-zinc-300 dark:border-zinc-700 bg-zinc-200 dark:bg-zinc-800 text-zinc-900 dark:text-zinc-100 font-semibold transition-all duration-200 focus:border-indigo-500 dark:focus:border-indigo-500 focus:ring-2 focus:ring-indigo-200 dark:focus:ring-indigo-700 focus:shadow-md cursor-pointer",calendarClassName:"custom-datepicker-calendar",dayClassName:e=>{let a=new Date,t=e.toDateString()===a.toDateString(),o=r&&e.toDateString()===r.toDateString(),i="hover:bg-indigo-100 dark:hover:bg-indigo-900 rounded-lg transition-colors duration-200";return t&&(i+=" bg-blue-100 dark:bg-blue-900 text-blue-800 dark:text-blue-200 font-semibold"),o&&(i+=" bg-indigo-500 text-white font-bold"),i},renderCustomHeader:e=>{let{date:r,decreaseMonth:a,increaseMonth:o,prevMonthButtonDisabled:i,nextMonthButtonDisabled:s}=e;return(0,t.jsxs)("div",{className:"jsx-e84ae2c801487fae flex items-center justify-between p-3 bg-gradient-to-r from-indigo-500 to-purple-600 text-white rounded-t-lg",children:[(0,t.jsx)("button",{onClick:a,disabled:i,className:"jsx-e84ae2c801487fae p-2 rounded-lg hover:bg-white/20 transition-colors disabled:opacity-50 disabled:cursor-not-allowed",children:(0,t.jsx)("svg",{fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",className:"jsx-e84ae2c801487fae w-4 h-4",children:(0,t.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 19l-7-7 7-7",className:"jsx-e84ae2c801487fae"})})}),(0,t.jsx)("div",{className:"jsx-e84ae2c801487fae text-lg font-bold",children:r.toLocaleDateString("pt-BR",{month:"long",year:"numeric"})}),(0,t.jsx)("button",{onClick:o,disabled:s,className:"jsx-e84ae2c801487fae p-2 rounded-lg hover:bg-white/20 transition-colors disabled:opacity-50 disabled:cursor-not-allowed",children:(0,t.jsx)("svg",{fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",className:"jsx-e84ae2c801487fae w-4 h-4",children:(0,t.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 5l7 7-7 7",className:"jsx-e84ae2c801487fae"})})})]})}}),(0,t.jsx)(i(),{id:"e84ae2c801487fae",children:".custom-datepicker-popper{z-index:9999!important}.custom-datepicker-calendar{border:none!important;border-radius:.75rem!important;box-shadow:0 10px 25px rgba(0,0,0,.15)!important;overflow:hidden!important}.react-datepicker{border:none!important;font-family:inherit!important}.react-datepicker__header{background:transparent!important;border:none!important;padding:0!important}.react-datepicker__month-container{background:white!important}.dark .react-datepicker__month-container{background:#1f2937!important}.react-datepicker__day-names{background:#f8fafc!important;padding:.5rem 0!important}.dark .react-datepicker__day-names{background:#374151!important}.react-datepicker__day-name{color:#6b7280!important;font-weight:600!important;font-size:.875rem!important}.dark .react-datepicker__day-name{color:#9ca3af!important}.react-datepicker__day{color:#374151!important;font-weight:500!important;border-radius:.5rem!important;margin:.125rem!important;width:2rem!important;height:2rem!important;line-height:2rem!important;transition:all.2s ease!important}.dark .react-datepicker__day{color:#d1d5db!important}.react-datepicker__day:hover{background-color:#e0e7ff!important;color:#3730a3!important}.dark .react-datepicker__day:hover{background-color:#4338ca!important;color:#fff!important}.react-datepicker__day--selected{background-color:#6366f1!important;color:#fff!important;font-weight:700!important}.react-datepicker__day--today{background-color:#dbeafe!important;color:#1e40af!important;font-weight:600!important}.dark .react-datepicker__day--today{background-color:#1e3a8a!important;color:#dbeafe!important}.react-datepicker__day--outside-month{color:#9ca3af!important}.dark .react-datepicker__day--outside-month{color:#6b7280!important}.react-datepicker__day--disabled{color:#d1d5db!important;cursor:not-allowed!important}.dark .react-datepicker__day--disabled{color:#4b5563!important}"})]})}a(9157)},4589:(e,r,a)=>{"use strict";a.d(r,{K:()=>n});var t=a(5155),o=a(8209),i=a(63),s=a(2115);function n(e){let{children:r,requiredRole:a="user",fallbackPath:n="/relatorios"}=e,{isAuthenticated:c,isAdmin:d,isLoading:l}=(0,o.A)(),u=(0,i.useRouter)();if((0,s.useEffect)(()=>{if(!l&&c){let e=!1;switch(a){case"host":case"admin":e=d;break;case"user":e=!0}e||u.push(n)}},[c,d,l,a,n,u]),l)return(0,t.jsx)("div",{className:"min-h-screen bg-gradient-to-br from-slate-50 to-blue-50 dark:from-slate-900 dark:to-blue-900 flex items-center justify-center",children:(0,t.jsxs)("div",{className:"text-center",children:[(0,t.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto mb-4"}),(0,t.jsx)("p",{className:"text-slate-600 dark:text-slate-400",children:"Verificando permiss\xf5es..."})]})});if(!c)return null;let m=!1;switch(a){case"host":case"admin":m=d;break;case"user":m=!0}return m?(0,t.jsx)(t.Fragment,{children:r}):(0,t.jsx)("div",{className:"min-h-screen bg-gradient-to-br from-slate-50 to-blue-50 dark:from-slate-900 dark:to-blue-900 flex items-center justify-center",children:(0,t.jsxs)("div",{className:"text-center bg-white dark:bg-slate-800 p-8 rounded-xl shadow-lg",children:[(0,t.jsx)("div",{className:"text-red-500 text-6xl mb-4",children:"\uD83D\uDEAB"}),(0,t.jsx)("h1",{className:"text-2xl font-bold text-slate-800 dark:text-slate-200 mb-2",children:"Acesso Negado"}),(0,t.jsx)("p",{className:"text-slate-600 dark:text-slate-400 mb-6",children:"Voc\xea n\xe3o tem permiss\xe3o para acessar esta p\xe1gina."}),(0,t.jsx)("button",{onClick:()=>u.push(n),className:"bg-blue-600 hover:bg-blue-700 text-white px-6 py-3 rounded-lg font-semibold transition-colors duration-200",children:"Voltar ao In\xedcio"})]})})}},4591:(e,r,a)=>{"use strict";a.r(r),a.d(r,{default:()=>u});var t=a(5155),o=a(2115),i=a(3372),s=a(6020),n=a(9675),c=a(4389),d=a(4589),l=a(4744);function u(){let[e,r]=(0,o.useState)("Servi\xe7os Rotineiros"),[a,u]=(0,o.useState)(null),[m,p]=(0,o.useState)("SP"),[h,g]=(0,o.useState)([]),[x,b]=(0,o.useState)({});async function f(){if(!a)return void l.oR.error("Por favor, selecione a data dos servi\xe7os rotineiros.");if(0===h.length)return void l.oR.error("Por favor, selecione pelo menos um servi\xe7o executado.");let r=Date.now(),t=(0,n.A)(),o={id:t,tipoServico:"ROTINEIROS",assunto:e,data:a.toISOString().split("T")[0],sub:m,servicos:h.map(e=>({assunto:e,fotos:(x[e]||[]).map(e=>({url:e,descricao:""})),observacao:""})),createdAt:r,updatedAt:r};try{await (0,i.wt)(o),l.oR.success("Relat\xf3rio salvo com sucesso!"),window.location.href="/relatorios"}catch(e){console.error("Erro ao salvar relat\xf3rio:",e),l.oR.error("Erro ao salvar. Tentando limpar relat\xf3rios antigos..."),await (0,i.gI)();try{await (0,i.wt)(o),l.oR.success("Relat\xf3rio salvo com sucesso!"),window.location.href="/relatorios"}catch(e){l.oR.error("Erro persistente. Por favor, tente novamente com menos fotos."),console.error("Erro persistente:",e)}}}return(0,t.jsx)(d.K,{requiredRole:"admin",children:(0,t.jsxs)("div",{className:"space-y-6",children:[(0,t.jsx)("div",{className:"bg-gradient-to-r from-green-500 to-emerald-600 rounded-xl p-6 text-white shadow-lg",children:(0,t.jsxs)("div",{className:"flex items-center gap-3",children:[(0,t.jsx)("div",{className:"p-3 bg-white/20 rounded-lg",children:(0,t.jsx)("svg",{className:"w-8 h-8",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,t.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 5H7a2 2 0 00-2 2v10a2 2 0 002 2h8a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2m-3 7h3m-3 4h3m-6-4h.01M9 16h.01"})})}),(0,t.jsxs)("div",{children:[(0,t.jsx)("h1",{className:"text-2xl font-bold",children:"\uD83D\uDD27 Servi\xe7os Rotineiros"}),(0,t.jsx)("p",{className:"text-green-100",children:"Registre servi\xe7os rotineiros executados pela equipe"})]})]})}),(0,t.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,t.jsxs)("div",{className:"flex flex-col gap-1",children:[(0,t.jsx)("label",{className:"text-xs text-black dark:text-zinc-400 font-bold",children:"Assunto"}),(0,t.jsx)("input",{value:e,disabled:!0,className:"bg-zinc-200 dark:bg-zinc-700 text-zinc-900 dark:text-zinc-300 px-3 py-2 rounded border border-zinc-300 dark:border-zinc-600 cursor-not-allowed font-semibold"})]}),(0,t.jsxs)("div",{className:"flex flex-col gap-1",children:[(0,t.jsx)("label",{className:"text-xs text-black dark:text-zinc-400 font-bold",children:"Data"}),(0,t.jsx)(c.A,{selectedDate:a,onChange:u,placeholder:"Selecione a data dos servi\xe7os"})]}),(0,t.jsxs)("div",{className:"flex flex-col gap-1",children:[(0,t.jsx)("label",{className:"text-xs text-black dark:text-zinc-400 font-bold",children:"Sub-regi\xe3o"}),(0,t.jsxs)("select",{value:m,onChange:e=>p(e.target.value),className:"bg-zinc-200 dark:bg-zinc-800 text-zinc-900 dark:text-zinc-100 px-3 py-2 rounded border border-zinc-300 dark:border-zinc-700 font-semibold transition-all duration-200 focus:border-zinc-500 dark:focus:border-zinc-500 focus:ring-2 focus:ring-zinc-200 dark:focus:ring-zinc-700 focus:shadow-md",children:[(0,t.jsx)("option",{value:"SP",children:s.iU.SP}),(0,t.jsx)("option",{value:"CV",children:s.iU.CV}),(0,t.jsx)("option",{value:"JT",children:s.iU.JT}),(0,t.jsx)("option",{value:"MG",children:s.iU.MG}),(0,t.jsx)("option",{value:"ST",children:s.iU.ST})]})]})]}),(0,t.jsxs)("section",{className:"space-y-4",children:[(0,t.jsx)("h2",{className:"font-medium",children:"Servi\xe7os Executados"}),(0,t.jsx)("div",{className:"text-xs text-zinc-600 dark:text-zinc-400 mb-2",children:"\uD83D\uDCA1 Selecione os servi\xe7os executados e adicione fotos para cada um"}),(0,t.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:s.ZU.map(e=>{var r;return(0,t.jsxs)("div",{className:"space-y-3",children:[(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsx)("input",{type:"checkbox",id:"servico-".concat(e),checked:h.includes(e),onChange:()=>{g(r=>{if(!r.includes(e))return[...r,e];{let a={...x};return delete a[e],b(a),r.filter(r=>r!==e)}})},className:"w-4 h-4 text-green-600 bg-zinc-100 border-zinc-300 rounded focus:ring-green-500 dark:focus:ring-green-600 dark:ring-offset-zinc-800 focus:ring-2 dark:bg-zinc-700 dark:border-zinc-600"}),(0,t.jsx)("label",{htmlFor:"servico-".concat(e),className:"text-sm font-medium text-zinc-900 dark:text-zinc-300 cursor-pointer",children:e})]}),h.includes(e)&&(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsxs)("div",{className:"flex items-center justify-between",children:[(0,t.jsxs)("span",{className:"text-xs text-zinc-600 dark:text-zinc-400",children:["Fotos: ",(null==(r=x[e])?void 0:r.length)||0,"/10"]}),(0,t.jsx)("button",{onClick:()=>(function(e){let r=document.createElement("input");r.type="file",r.accept="image/*",r.multiple=!0,r.onchange=r=>{let a=r.target.files;if(a&&a.length>0){let r=Array.from(a),t=x[e]||[];if(t.length+r.length>10)return void l.oR.error("M\xe1ximo de 10 fotos por servi\xe7o. Voc\xea j\xe1 tem ".concat(t.length," foto(s) para este servi\xe7o."));r.forEach((r,a)=>{(function(e){let r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:800,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:.7;return new Promise(t=>{let o=document.createElement("canvas"),i=o.getContext("2d"),s=new Image;s.onload=()=>{let{width:e,height:n}=s;e>r&&(n=n*r/e,e=r),o.width=e,o.height=n,null==i||i.drawImage(s,0,0,e,n),t(o.toDataURL("image/jpeg",a))},s.src=URL.createObjectURL(e)})})(r,800,.8).then(r=>{b(a=>({...a,[e]:[...a[e]||[],r]}))})})}},r.click()})(e),className:"text-xs bg-green-600 hover:bg-green-500 text-white px-2 py-1 rounded",children:"\uD83D\uDCF8 Adicionar Fotos"})]}),x[e]&&x[e].length>0&&(0,t.jsx)("div",{className:"grid grid-cols-2 gap-2",children:x[e].map((r,a)=>(0,t.jsxs)("div",{className:"relative",children:[(0,t.jsx)("img",{src:r,alt:"".concat(e," - Foto ").concat(a+1),className:"w-full h-20 object-cover rounded border border-zinc-300 dark:border-zinc-600"}),(0,t.jsx)("button",{onClick:()=>{b(r=>{var t;return{...r,[e]:(null==(t=r[e])?void 0:t.filter((e,r)=>r!==a))||[]}})},className:"absolute -top-1 -right-1 bg-red-600 hover:bg-red-500 text-white rounded-full w-5 h-5 flex items-center justify-center text-xs",children:"\xd7"})]},a))})]})]},e)})})]}),(0,t.jsxs)("div",{className:"pt-2 flex gap-3",children:[(0,t.jsxs)("button",{onClick:f,className:"bg-green-600 hover:bg-green-500 text-white px-4 py-2 rounded flex items-center gap-2",children:[(0,t.jsx)("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,t.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M5 13l4 4L19 7"})}),"\uD83D\uDCBE Salvar"]}),(0,t.jsx)("button",{onClick:()=>window.history.back(),className:"bg-zinc-600 hover:bg-zinc-500 text-white px-4 py-2 rounded",children:"Voltar"})]})]})})}},6020:(e,r,a)=>{"use strict";a.d(r,{DZ:()=>i,ZU:()=>s,iU:()=>t,k4:()=>o,zb:()=>n});let t={SP:"S\xc3O PAULO",CV:"CASA VERDE / LIM\xc3O / CACHOEIRINHA",JT:"JA\xc7AN\xc3 / TREMEMB\xc9",MG:"VILA MARIA / VILA GUILHERME",ST:"SANTANA / TUCURUVI"},o={MUTIRAO:"Mutir\xe3o - SELIMP",REVITALIZACAO:"Revitaliza\xe7\xe3o de Pontos Viciados",ACUMULADOR:"A\xe7\xe3o de Acumulador",ALAGAMENTOS:"Limpeza P\xf3s Alagamento",ZELADORIA:"Zeladoria",DDS:"DDS",HIGIENIZACAO:"Higieniza\xe7\xe3o, manuten\xe7\xe3o, instala\xe7\xe3o, remo\xe7\xe3o e reposi\xe7\xe3o de Papeleiras",VARRICAO_MECANIZADA:"Varri\xe7\xe3o Mecanizada",FEIRAS:"Feiras",EVENTOS:"Eventos",ROTINEIROS:"Servi\xe7os Rotineiros"},i=["Acumulador","Alagamentos","Zeladoria"],s=["Capina\xe7\xe3o e Ro\xe7agem","Cata Bagulho","Coleta manual e transporte de materiais diversos/entulho","Coleta mecanizada e transporte de materiais diversos e de entulho","Grandes Objetos - Coleta e transporte de objetos volumosos","Higieniza\xe7\xe3o, manuten\xe7\xe3o, instala\xe7\xe3o, remo\xe7\xe3o e reposi\xe7\xe3o de Papeleiras","Lavagem Especial de Equipamentos P\xfablicos","Limpeza de Boca de Lobo","Mutir\xe3o","Raspagem da terra e areia nas sarjetas de vias p\xfablicas","Remo\xe7\xe3o de faixas e propagandas irregulares","Servi\xe7o de pintura de meio fio","Varri\xe7\xe3o Manual de Vias e Logradouros Publicos","Varri\xe7\xe3o Mecanizada","Desfazimento","Varri\xe7\xe3o de Pra\xe7a","Feiras","Ecopontos"],n={CV:["Ecoponto Vila Nova Cachoeirinha","Ecoponto Vila Santa Maria","Ecoponto Parque Peruche","Ecoponto Jardim Ant\xe1rtica","Ecoponto S\xe3o Leandro"],MG:["Ecoponto Vila Sabrina","Ecoponto Vila Guilherme","Ecoponto Vila Maria"],ST:["Ecoponto Santana","Ecoponto Tucuruvi"],JT:["Ecoponto Anselmo Machado","Ecoponto Silvio Bittencourt"]}},8209:(e,r,a)=>{"use strict";a.d(r,{A:()=>s,Y:()=>n});var t=a(2115),o=a(3361);let i={"marcos.silva":"marcos.silva@limpebras.com",admin:"admin@test.com","admin@test.com":"admin@test.com",usuario1:"usuario1@limpebras.com",usuario2:"usuario2@limpebras.com"};function s(){let[e,r]=(0,t.useState)({isAuthenticated:!1,user:null,isLoading:!0,login:async()=>!1,logout:()=>{},isAdmin:!1});(0,t.useEffect)(()=>{localStorage.getItem("auth_token")?(o.y1.initToken(),o.y1.getProfile().then(e=>{r(r=>({...r,isAuthenticated:!0,user:{id:e.id,nome:e.nome,email:e.email,username:e.email.split("@")[0],role:e.role,created_at:e.created_at},isLoading:!1,isAdmin:"admin"===e.role}))}).catch(e=>{console.error("Token inv\xe1lido:",e),localStorage.removeItem("auth_token"),r(e=>({...e,isAuthenticated:!1,user:null,isLoading:!1,isAdmin:!1}))})):r(e=>({...e,isAuthenticated:!1,user:null,isLoading:!1,isAdmin:!1}))},[]);let a=async(e,a)=>{try{let t=i[e]||e,s=await o.y1.login(t,a);if(s.token&&s.user)return r(r=>({...r,isAuthenticated:!0,user:{id:s.user.id,nome:s.user.nome,email:s.user.email,username:e,role:s.user.role},isLoading:!1,isAdmin:"admin"===s.user.role})),console.log("Login successful, user authenticated:",s.user),!0;return console.log("Login failed - invalid response"),!1}catch(e){return console.error("Erro no login:",e),!1}};return{...e,login:a,logout:()=>{o.y1.logout(),r(e=>({...e,isAuthenticated:!1,user:null,isLoading:!1,isAdmin:!1}))},isAdmin:e.isAdmin}}function n(){let[e,r]=(0,t.useState)([]),[a,i]=(0,t.useState)(!1),s=async()=>{try{i(!0),r([])}catch(e){console.error("Erro ao carregar usu\xe1rios:",e)}finally{i(!1)}};return(0,t.useEffect)(()=>{s()},[]),{users:e,loading:a,addUser:async e=>{try{let r=await o.y1.register(e);return await s(),r.user}catch(e){throw console.error("Erro ao adicionar usu\xe1rio:",e),e}},updateUser:async(e,r)=>{try{await o.y1.updateProfile(r),await s()}catch(e){throw console.error("Erro ao atualizar usu\xe1rio:",e),e}},deleteUser:async e=>{try{await s()}catch(e){throw console.error("Erro ao deletar usu\xe1rio:",e),e}},toggleUserStatus:async e=>{try{await s()}catch(e){throw console.error("Erro ao alterar status do usu\xe1rio:",e),e}},refreshUsers:s}}}},e=>{e.O(0,[3038,5579,4020,4744,1061,1780,3372,8441,1255,7358],()=>e(e.s=674)),_N_E=e.O()}]);