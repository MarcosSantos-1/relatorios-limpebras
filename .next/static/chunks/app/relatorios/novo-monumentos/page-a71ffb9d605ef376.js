(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[7848],{63:(e,r,t)=>{"use strict";var a=t(7260);t.o(a,"usePathname")&&t.d(r,{usePathname:function(){return a.usePathname}}),t.o(a,"useRouter")&&t.d(r,{useRouter:function(){return a.useRouter}})},3471:(e,r,t)=>{Promise.resolve().then(t.bind(t,4808))},4589:(e,r,t)=>{"use strict";t.d(r,{K:()=>s});var a=t(5155),o=t(8209),n=t(63),i=t(2115);function s(e){let{children:r,requiredRole:t="user",fallbackPath:s="/relatorios"}=e,{isAuthenticated:l,isAdmin:c,isLoading:d}=(0,o.A)(),u=(0,n.useRouter)();if((0,i.useEffect)(()=>{if(!d&&l){let e=!1;switch(t){case"host":case"admin":e=c;break;case"user":e=!0}e||u.push(s)}},[l,c,d,t,s,u]),d)return(0,a.jsx)("div",{className:"min-h-screen bg-gradient-to-br from-slate-50 to-blue-50 dark:from-slate-900 dark:to-blue-900 flex items-center justify-center",children:(0,a.jsxs)("div",{className:"text-center",children:[(0,a.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto mb-4"}),(0,a.jsx)("p",{className:"text-slate-600 dark:text-slate-400",children:"Verificando permiss\xf5es..."})]})});if(!l)return null;let m=!1;switch(t){case"host":case"admin":m=c;break;case"user":m=!0}return m?(0,a.jsx)(a.Fragment,{children:r}):(0,a.jsx)("div",{className:"min-h-screen bg-gradient-to-br from-slate-50 to-blue-50 dark:from-slate-900 dark:to-blue-900 flex items-center justify-center",children:(0,a.jsxs)("div",{className:"text-center bg-white dark:bg-slate-800 p-8 rounded-xl shadow-lg",children:[(0,a.jsx)("div",{className:"text-red-500 text-6xl mb-4",children:"\uD83D\uDEAB"}),(0,a.jsx)("h1",{className:"text-2xl font-bold text-slate-800 dark:text-slate-200 mb-2",children:"Acesso Negado"}),(0,a.jsx)("p",{className:"text-slate-600 dark:text-slate-400 mb-6",children:"Voc\xea n\xe3o tem permiss\xe3o para acessar esta p\xe1gina."}),(0,a.jsx)("button",{onClick:()=>u.push(s),className:"bg-blue-600 hover:bg-blue-700 text-white px-6 py-3 rounded-lg font-semibold transition-colors duration-200",children:"Voltar ao In\xedcio"})]})})}},4808:(e,r,t)=>{"use strict";t.r(r),t.d(r,{default:()=>d});var a=t(5155),o=t(2115),n=t(3372),i=t(9675),s=t(4589),l=t(4744);let c={CV:[{id:"CV1LM0001",monumento:"Adhemar Ferreira Da Silva",local:"Canteiro Central Da Avenida Braz Leme, Altura Do N\xfamero 1000"}],JT:[{id:"JT1LM0001",monumento:"Marechal Do Ar Alberto Santos Dumont",local:"Pra\xe7a Comandante Eduardo De Oliveira"},{id:"JT1LM0002",monumento:"Marco Rodovi\xe1rio",local:"Avenida Senador Jos\xe9 Erm\xedrio De Moraes (Em Frente \xc0 Entrada Do Parque Estadual Da Cantareira N\xfacleos \xc1guas Claras)"}],MG:[{id:"MG1LM0001",monumento:"Aos Pracinhas a Homenagem e a Gratid\xe3o do Parque Novo Mundo",local:"Pra\xe7a Parque Novo Mundo"},{id:"MG1LM0002",monumento:"Monumento \xe0 Legalidade",local:"Rua Amanba\xed, 9 (Interior do III Batalh\xe3o de Choque da Pol\xedcia Militar de S\xe3o Paulo)"},{id:"MG1LM0003",monumento:"Homenagem ao C\xe3o Salom\xe3o",local:"Pra\xe7a Oscar da Silva"}],ST:[{id:"ST1LM0001",monumento:"Menorah",local:"Pra\xe7a Mashiach Now"},{id:"ST1LM0002",monumento:"Vit\xf3ria",local:"Avenida Santos Dumont (Canteiro Central, Em Frente Ao N\xfamero 1313)"},{id:"ST1LM0003",monumento:"14 Bis",local:"Pra\xe7a Campo De Bagatelle"},{id:"ST1LM0004",monumento:"Monumento Aos Her\xf3is Da FEB",local:"Pra\xe7a Her\xf3is Da For\xe7a Expedicion\xe1ria Brasileira"},{id:"ST1LM0005",monumento:"Nossa Senhora Auxiliadora",local:"Pra\xe7a Domingos Correia Da Cruz"}]};function d(){var e;let[r,t]=(0,o.useState)("Limpeza e Conserva\xe7\xe3o de Monumentos P\xfablicos"),[d,u]=(0,o.useState)(null),[m,h]=(0,o.useState)("SP"),[x,b]=(0,o.useState)(""),[g,p]=(0,o.useState)(""),[f,v]=(0,o.useState)(""),[z,j]=(0,o.useState)(""),[k,N]=(0,o.useState)(""),[w,y]=(0,o.useState)({antes:"",durante:"",depois:""});function S(e,r){(function(e){let r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:800,t=arguments.length>2&&void 0!==arguments[2]?arguments[2]:.8;return new Promise(a=>{let o=document.createElement("canvas"),n=o.getContext("2d"),i=new Image;i.onload=()=>{let{width:e,height:s}=i;e>r&&(s=s*r/e,e=r),o.width=e,o.height=s,null==n||n.drawImage(i,0,0,e,s),o.toBlob(e=>{a(URL.createObjectURL(e))},"image/jpeg",t)},i.src=URL.createObjectURL(e)})})(e,800,.8).then(r)}function A(e,r){y(t=>({...t,[e]:r}))}async function D(){if(!d)return void l.oR.error("Por favor, selecione a data do servi\xe7o.");if(!x)return void l.oR.error("Por favor, selecione um setor.");let e=Date.now(),t=(0,i.A)(),a=[...w.antes?[{url:w.antes,etapa:"ANTES",descricao:"Antes",ordem:1}]:[],...w.durante?[{url:w.durante,etapa:"DURANTE",descricao:"Durante",ordem:2}]:[],...w.depois?[{url:w.depois,etapa:"DEPOIS",descricao:"Depois",ordem:3}]:[]],o={id:t,tipoServico:"REGISTRO",assunto:r,data:d.toISOString().split("T")[0],sub:m,setorSelecionado:x,monumento:g,local:f,descricao:z,fichaFotoUrl:k,fotos:a,createdAt:e,updatedAt:e};try{await (0,n.wt)(o),l.oR.success("Relat\xf3rio salvo com sucesso!"),window.location.href="/relatorios"}catch(e){console.error("Erro ao salvar relat\xf3rio:",e),l.oR.error("Erro ao salvar. Tentando limpar relat\xf3rios antigos..."),await (0,n.gI)();try{await (0,n.wt)(o),l.oR.success("Relat\xf3rio salvo com sucesso!"),window.location.href="/relatorios"}catch(e){l.oR.error("Erro persistente. Por favor, tente novamente com menos fotos."),console.error("Erro persistente:",e)}}}return(0,a.jsx)(s.K,{requiredRole:"admin",children:(0,a.jsxs)("div",{className:"space-y-6",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsx)("h1",{className:"text-2xl font-bold text-zinc-900 dark:text-zinc-100",children:"Novo Relat\xf3rio - Monumentos"}),(0,a.jsx)("button",{onClick:D,className:"px-6 py-3 bg-blue-600 hover:bg-blue-500 text-white rounded-lg font-semibold transition-colors",children:"Salvar Relat\xf3rio"})]}),(0,a.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[(0,a.jsxs)("div",{className:"bg-zinc-100 dark:bg-zinc-900 border border-zinc-200 dark:border-zinc-800 rounded-lg p-6",children:[(0,a.jsx)("h2",{className:"text-lg font-semibold mb-4 text-zinc-900 dark:text-zinc-100",children:"Informa\xe7\xf5es B\xe1sicas"}),(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-zinc-700 dark:text-zinc-300 mb-2",children:"Assunto"}),(0,a.jsx)("input",{type:"text",value:r,onChange:e=>t(e.target.value),className:"w-full bg-white dark:bg-zinc-800 text-zinc-900 dark:text-zinc-100 px-3 py-2 rounded border border-zinc-300 dark:border-zinc-700"})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-zinc-700 dark:text-zinc-300 mb-2",children:"Data"}),(0,a.jsx)("input",{type:"date",value:d?d.toISOString().split("T")[0]:"",onChange:e=>u(e.target.value?new Date(e.target.value):null),className:"w-full bg-white dark:bg-zinc-800 text-zinc-900 dark:text-zinc-100 px-3 py-2 rounded border border-zinc-300 dark:border-zinc-700 font-semibold"})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-zinc-700 dark:text-zinc-300 mb-2",children:"Sub-regi\xe3o"}),(0,a.jsxs)("select",{value:m,onChange:e=>{h(e.target.value),b(""),p(""),v("")},className:"w-full bg-white dark:bg-zinc-800 text-zinc-900 dark:text-zinc-100 px-3 py-2 rounded border border-zinc-300 dark:border-zinc-700",children:[(0,a.jsx)("option",{value:"CV",children:"Casa Verde / Lim\xe3o / Cachoeirinha"}),(0,a.jsx)("option",{value:"JT",children:"Ja\xe7an\xe3 / Trememb\xe9"}),(0,a.jsx)("option",{value:"MG",children:"Vila Maria / Vila Guilherme"}),(0,a.jsx)("option",{value:"ST",children:"Santana / Tucuruvi"})]})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-zinc-700 dark:text-zinc-300 mb-2",children:"Setor"}),(0,a.jsxs)("select",{value:x,onChange:e=>(function(e){var r;b(e);let t=null==(r=c[m])?void 0:r.find(r=>r.id===e);t&&(p(t.monumento),v(t.local))})(e.target.value),className:"w-full bg-white dark:bg-zinc-800 text-zinc-900 dark:text-zinc-100 px-3 py-2 rounded border border-zinc-300 dark:border-zinc-700",disabled:!m,children:[(0,a.jsx)("option",{value:"",children:"Selecione um setor"}),null==(e=c[m])?void 0:e.map(e=>(0,a.jsx)("option",{value:e.id,children:e.id},e.id))]})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-zinc-700 dark:text-zinc-300 mb-2",children:"Monumento"}),(0,a.jsx)("input",{type:"text",value:g,onChange:e=>p(e.target.value),className:"w-full bg-white dark:bg-zinc-800 text-zinc-900 dark:text-zinc-100 px-3 py-2 rounded border border-zinc-300 dark:border-zinc-700",placeholder:"Ser\xe1 preenchido automaticamente"})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-zinc-700 dark:text-zinc-300 mb-2",children:"Local Atendido"}),(0,a.jsx)("input",{type:"text",value:f,onChange:e=>v(e.target.value),className:"w-full bg-white dark:bg-zinc-800 text-zinc-900 dark:text-zinc-100 px-3 py-2 rounded border border-zinc-300 dark:border-zinc-700",placeholder:"Ser\xe1 preenchido automaticamente"})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-zinc-700 dark:text-zinc-300 mb-2",children:"Descri\xe7\xe3o"}),(0,a.jsx)("textarea",{value:z,onChange:e=>j(e.target.value),rows:3,className:"w-full bg-white dark:bg-zinc-800 text-zinc-900 dark:text-zinc-100 px-3 py-2 rounded border border-zinc-300 dark:border-zinc-700",placeholder:"Descri\xe7\xe3o do servi\xe7o executado"})]})]})]}),(0,a.jsxs)("div",{className:"bg-zinc-100 dark:bg-zinc-900 border border-zinc-200 dark:border-zinc-800 rounded-lg p-6",children:[(0,a.jsx)("h2",{className:"text-lg font-semibold mb-4 text-zinc-900 dark:text-zinc-100",children:"Fotos"}),(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-zinc-700 dark:text-zinc-300 mb-2",children:"Foto da Ficha (Opcional)"}),(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)("input",{type:"file",accept:"image/*",onChange:e=>{var r;let t=null==(r=e.target.files)?void 0:r[0];t&&S(t,N)},className:"w-full bg-white dark:bg-zinc-800 text-zinc-900 dark:text-zinc-100 px-3 py-2 rounded border border-zinc-300 dark:border-zinc-700"}),k&&(0,a.jsxs)("div",{className:"relative",children:[(0,a.jsx)("img",{src:k,alt:"Foto da Ficha",className:"w-full h-40 object-cover rounded border border-zinc-300 dark:border-zinc-600"}),(0,a.jsx)("button",{onClick:()=>N(""),className:"absolute top-2 right-2 w-6 h-6 bg-red-600 hover:bg-red-500 text-white rounded-full text-xs flex items-center justify-center",children:"\xd7"})]})]})]}),(0,a.jsxs)("section",{className:"space-y-4",children:[(0,a.jsxs)("div",{className:"flex justify-between items-center",children:[(0,a.jsx)("h2",{className:"font-medium",children:"Fotos dos Monumentos"}),(0,a.jsxs)("div",{className:"flex gap-2",children:[(0,a.jsx)("input",{type:"file",accept:"image/*",multiple:!0,onChange:e=>{let r=e.target.files;r&&r.length>0&&function(e){let r=Array.from(e);3===r.length?r.forEach((e,r)=>{let t=["antes","durante","depois"];S(e,e=>A(t[r],e))}):2===r.length?r.forEach((e,r)=>{let t=["antes","depois"];S(e,e=>A(t[r],e))}):1===r.length&&S(r[0],e=>A("antes",e))}(r)},className:"hidden",id:"multiple-monumentos"}),(0,a.jsx)("label",{htmlFor:"multiple-monumentos",className:"bg-indigo-600 hover:bg-indigo-500 text-white px-3 py-1 rounded text-xs cursor-pointer transition-colors",children:"\uD83D\uDCF8 Upload m\xfaltiplo"})]})]}),(0,a.jsx)("div",{className:"text-xs text-zinc-600 dark:text-zinc-400 mb-2",children:'\uD83D\uDCA1 Dica: Use "Upload m\xfaltiplo" para adicionar 1, 2 ou 3 fotos de uma vez (antes/durante/depois)'}),(0,a.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:["antes","durante","depois"].map(e=>(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)("label",{className:"text-xs text-zinc-700 dark:text-zinc-400 capitalize font-medium",children:e}),(0,a.jsxs)("div",{className:"relative",children:[(0,a.jsx)("input",{type:"file",accept:"image/*",onChange:r=>{var t;let a=null==(t=r.target.files)?void 0:t[0];a&&S(a,r=>A(e,r))},className:"absolute inset-0 w-full h-full opacity-0 cursor-pointer z-10",id:"monumentos-".concat(e)}),(0,a.jsx)("label",{htmlFor:"monumentos-".concat(e),className:"flex flex-col items-center justify-center w-full h-32 border-2 border-dashed border-zinc-300 dark:border-zinc-600 rounded-lg cursor-pointer bg-zinc-100 dark:bg-zinc-800 hover:bg-zinc-200 dark:hover:bg-zinc-750 hover:border-indigo-500 transition-colors",children:(0,a.jsxs)("div",{className:"flex flex-col items-center justify-center pt-5 pb-6",children:[(0,a.jsx)("svg",{className:"w-8 h-8 mb-2 text-zinc-500 dark:text-zinc-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12"})}),(0,a.jsxs)("p",{className:"text-xs text-zinc-600 dark:text-zinc-400 text-center",children:[(0,a.jsx)("span",{className:"font-medium",children:"Clique para adicionar"}),(0,a.jsx)("br",{}),"foto da etapa ",e]})]})})]}),w[e]&&(0,a.jsx)("div",{className:"w-full h-32 border border-zinc-300 dark:border-zinc-600 rounded overflow-hidden mt-2",children:(0,a.jsx)("img",{src:w[e],alt:"Monumentos - ".concat(e),className:"w-full h-full object-cover"})})]},e))})]})]})]})]})]})})}},8209:(e,r,t)=>{"use strict";t.d(r,{A:()=>i,Y:()=>s});var a=t(2115),o=t(3361);let n={"marcos.silva":"marcos.silva@limpebras.com",admin:"admin@test.com","admin@test.com":"admin@test.com",usuario1:"usuario1@limpebras.com",usuario2:"usuario2@limpebras.com"};function i(){let[e,r]=(0,a.useState)({isAuthenticated:!1,user:null,isLoading:!0,login:async()=>!1,logout:()=>{},isAdmin:!1});(0,a.useEffect)(()=>{localStorage.getItem("auth_token")?(o.y1.initToken(),o.y1.getProfile().then(e=>{r(r=>({...r,isAuthenticated:!0,user:{id:e.id,nome:e.nome,email:e.email,username:e.email.split("@")[0],role:e.role,created_at:e.created_at},isLoading:!1,isAdmin:"admin"===e.role}))}).catch(e=>{console.error("Token inv\xe1lido:",e),localStorage.removeItem("auth_token"),r(e=>({...e,isAuthenticated:!1,user:null,isLoading:!1,isAdmin:!1}))})):r(e=>({...e,isAuthenticated:!1,user:null,isLoading:!1,isAdmin:!1}))},[]);let t=async(e,t)=>{try{let a=n[e]||e,i=await o.y1.login(a,t);if(i.token&&i.user)return r(r=>({...r,isAuthenticated:!0,user:{id:i.user.id,nome:i.user.nome,email:i.user.email,username:e,role:i.user.role},isLoading:!1,isAdmin:"admin"===i.user.role})),console.log("Login successful, user authenticated:",i.user),!0;return console.log("Login failed - invalid response"),!1}catch(e){return console.error("Erro no login:",e),!1}};return{...e,login:t,logout:()=>{o.y1.logout(),r(e=>({...e,isAuthenticated:!1,user:null,isLoading:!1,isAdmin:!1}))},isAdmin:e.isAdmin}}function s(){let[e,r]=(0,a.useState)([]),[t,n]=(0,a.useState)(!1),i=async()=>{try{n(!0),r([])}catch(e){console.error("Erro ao carregar usu\xe1rios:",e)}finally{n(!1)}};return(0,a.useEffect)(()=>{i()},[]),{users:e,loading:t,addUser:async e=>{try{let r=await o.y1.register(e);return await i(),r.user}catch(e){throw console.error("Erro ao adicionar usu\xe1rio:",e),e}},updateUser:async(e,r)=>{try{await o.y1.updateProfile(r),await i()}catch(e){throw console.error("Erro ao atualizar usu\xe1rio:",e),e}},deleteUser:async e=>{try{await i()}catch(e){throw console.error("Erro ao deletar usu\xe1rio:",e),e}},toggleUserStatus:async e=>{try{await i()}catch(e){throw console.error("Erro ao alterar status do usu\xe1rio:",e),e}},refreshUsers:i}}},9675:(e,r,t)=>{"use strict";let a;t.d(r,{A:()=>s});let o={randomUUID:"undefined"!=typeof crypto&&crypto.randomUUID&&crypto.randomUUID.bind(crypto)},n=new Uint8Array(16),i=[];for(let e=0;e<256;++e)i.push((e+256).toString(16).slice(1));let s=function(e,r,t){if(o.randomUUID&&!r&&!e)return o.randomUUID();var s=e,l=t;let c=(s=s||{}).random??s.rng?.()??function(){if(!a){if("undefined"==typeof crypto||!crypto.getRandomValues)throw Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");a=crypto.getRandomValues.bind(crypto)}return a(n)}();if(c.length<16)throw Error("Random bytes length must be >= 16");if(c[6]=15&c[6]|64,c[8]=63&c[8]|128,r){if((l=l||0)<0||l+16>r.length)throw RangeError(`UUID byte range ${l}:${l+15} is out of buffer bounds`);for(let e=0;e<16;++e)r[l+e]=c[e];return r}return function(e,r=0){return(i[e[r+0]]+i[e[r+1]]+i[e[r+2]]+i[e[r+3]]+"-"+i[e[r+4]]+i[e[r+5]]+"-"+i[e[r+6]]+i[e[r+7]]+"-"+i[e[r+8]]+i[e[r+9]]+"-"+i[e[r+10]]+i[e[r+11]]+i[e[r+12]]+i[e[r+13]]+i[e[r+14]]+i[e[r+15]]).toLowerCase()}(c)}}},e=>{e.O(0,[4744,3372,8441,1255,7358],()=>e(e.s=3471)),_N_E=e.O()}]);