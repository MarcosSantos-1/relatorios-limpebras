(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[9377],{63:(e,r,o)=>{"use strict";var t=o(7260);o.o(t,"usePathname")&&o.d(r,{usePathname:function(){return t.usePathname}}),o.o(t,"useRouter")&&o.d(r,{useRouter:function(){return t.useRouter}})},4589:(e,r,o)=>{"use strict";o.d(r,{K:()=>n});var t=o(5155),a=o(8209),s=o(63),i=o(2115);function n(e){let{children:r,requiredRole:o="user",fallbackPath:n="/relatorios"}=e,{isAuthenticated:l,isAdmin:c,isLoading:d}=(0,a.A)(),u=(0,s.useRouter)();if((0,i.useEffect)(()=>{if(!d&&l){let e=!1;switch(o){case"host":case"admin":e=c;break;case"user":e=!0}e||u.push(n)}},[l,c,d,o,n,u]),d)return(0,t.jsx)("div",{className:"min-h-screen bg-gradient-to-br from-slate-50 to-blue-50 dark:from-slate-900 dark:to-blue-900 flex items-center justify-center",children:(0,t.jsxs)("div",{className:"text-center",children:[(0,t.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto mb-4"}),(0,t.jsx)("p",{className:"text-slate-600 dark:text-slate-400",children:"Verificando permiss\xf5es..."})]})});if(!l)return null;let m=!1;switch(o){case"host":case"admin":m=c;break;case"user":m=!0}return m?(0,t.jsx)(t.Fragment,{children:r}):(0,t.jsx)("div",{className:"min-h-screen bg-gradient-to-br from-slate-50 to-blue-50 dark:from-slate-900 dark:to-blue-900 flex items-center justify-center",children:(0,t.jsxs)("div",{className:"text-center bg-white dark:bg-slate-800 p-8 rounded-xl shadow-lg",children:[(0,t.jsx)("div",{className:"text-red-500 text-6xl mb-4",children:"\uD83D\uDEAB"}),(0,t.jsx)("h1",{className:"text-2xl font-bold text-slate-800 dark:text-slate-200 mb-2",children:"Acesso Negado"}),(0,t.jsx)("p",{className:"text-slate-600 dark:text-slate-400 mb-6",children:"Voc\xea n\xe3o tem permiss\xe3o para acessar esta p\xe1gina."}),(0,t.jsx)("button",{onClick:()=>u.push(n),className:"bg-blue-600 hover:bg-blue-700 text-white px-6 py-3 rounded-lg font-semibold transition-colors duration-200",children:"Voltar ao In\xedcio"})]})})}},5525:(e,r,o)=>{"use strict";o.r(r),o.d(r,{default:()=>d});var t=o(5155),a=o(2115),s=o(3372),i=o(6020),n=o(9675),l=o(4589),c=o(4744);function d(){let[e]=(0,a.useState)("Servi\xe7os Rotineiros"),[r,o]=(0,a.useState)(null),[d,u]=(0,a.useState)("CV"),[m,h]=(0,a.useState)(""),[g,x]=(0,a.useState)([]);async function p(){if(!r)return void c.oR.error("Por favor, selecione a data do servi\xe7o.");if(!m)return void c.oR.error("Por favor, selecione um ecoponto.");if(0===g.length)return void c.oR.error("Por favor, adicione pelo menos uma foto.");let o=Date.now(),t=(0,n.A)(),a={id:t,tipoServico:"ROTINEIROS",assunto:e,data:r.toISOString().split("T")[0],sub:d,servicos:[{assunto:m,fotos:g.map(e=>({url:e,descricao:m})),observacao:""}],createdAt:o,updatedAt:o};try{await (0,s.wt)(a),c.oR.success("Relat\xf3rio salvo com sucesso!"),window.location.href="/relatorios"}catch(e){console.error("Erro ao salvar relat\xf3rio:",e),c.oR.error("Erro ao salvar. Tentando limpar relat\xf3rios antigos..."),await (0,s.gI)();try{await (0,s.wt)(a),c.oR.success("Relat\xf3rio salvo com sucesso!"),window.location.href="/relatorios"}catch(e){c.oR.error("Erro persistente. Por favor, tente novamente com menos fotos.")}}}let f=i.zb[d]||[];return(0,t.jsx)(l.K,{requiredRole:"admin",children:(0,t.jsx)("div",{className:"min-h-screen bg-zinc-50 dark:bg-zinc-900 p-4",children:(0,t.jsxs)("div",{className:"max-w-4xl mx-auto space-y-6",children:[(0,t.jsx)("div",{className:"bg-gradient-to-r from-green-500 to-emerald-600 rounded-xl p-6 text-white shadow-lg",children:(0,t.jsxs)("div",{className:"flex items-center gap-3",children:[(0,t.jsx)("div",{className:"p-3 bg-white/20 rounded-lg",children:(0,t.jsx)("svg",{className:"w-8 h-8",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,t.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 21V5a2 2 0 00-2-2H7a2 2 0 00-2 2v16m14 0h2m-2 0h-5m-9 0H3m2 0h5M9 7h1m-1 4h1m4-4h1m-1 4h1m-5 10v-5a1 1 0 011-1h2a1 1 0 011 1v5m-4 0h4"})})}),(0,t.jsxs)("div",{className:"flex-1",children:[(0,t.jsx)("h1",{className:"text-2xl font-bold",children:"\uD83C\uDFED Cadastro de Ecopontos"}),(0,t.jsx)("p",{className:"text-green-100",children:"Registre servi\xe7os realizados nos ecopontos"})]}),(0,t.jsxs)("button",{onClick:()=>window.history.back(),className:"px-4 py-2 bg-white/20 hover:bg-white/30 text-white rounded-lg transition-colors duration-200 flex items-center gap-2",children:[(0,t.jsx)("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,t.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M10 19l-7-7m0 0l7-7m-7 7h18"})}),"Voltar"]})]})}),(0,t.jsxs)("div",{className:"bg-white dark:bg-zinc-800 rounded-xl shadow-lg p-6 space-y-6",children:[(0,t.jsx)("h2",{className:"text-xl font-semibold text-zinc-900 dark:text-zinc-100 mb-4",children:"Dados do Servi\xe7o"}),(0,t.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"block text-sm font-medium text-zinc-700 dark:text-zinc-300 mb-2",children:"Data do Servi\xe7o *"}),(0,t.jsx)("input",{type:"date",value:r?r.toISOString().split("T")[0]:"",onChange:e=>o(e.target.value?new Date(e.target.value):null),className:"w-full px-3 py-2 border border-zinc-300 dark:border-zinc-600 rounded-lg bg-white dark:bg-zinc-700 text-zinc-900 dark:text-zinc-100 focus:ring-2 focus:ring-green-500 focus:border-transparent"})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"block text-sm font-medium text-zinc-700 dark:text-zinc-300 mb-2",children:"Sub-regi\xe3o *"}),(0,t.jsxs)("select",{value:d,onChange:e=>{u(e.target.value),h("")},className:"w-full px-3 py-2 border border-zinc-300 dark:border-zinc-600 rounded-lg bg-white dark:bg-zinc-700 text-zinc-900 dark:text-zinc-100 focus:ring-2 focus:ring-green-500 focus:border-transparent",children:[(0,t.jsx)("option",{value:"CV",children:"Casa Verde / Lim\xe3o / Cachoeirinha"}),(0,t.jsx)("option",{value:"JT",children:"Ja\xe7an\xe3 / Trememb\xe9"}),(0,t.jsx)("option",{value:"MG",children:"Vila Maria / Vila Guilherme"}),(0,t.jsx)("option",{value:"ST",children:"Santana / Tucuruvi"})]})]})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"block text-sm font-medium text-zinc-700 dark:text-zinc-300 mb-2",children:"Ecoponto *"}),(0,t.jsxs)("select",{value:m,onChange:e=>h(e.target.value),className:"w-full px-3 py-2 border border-zinc-300 dark:border-zinc-600 rounded-lg bg-white dark:bg-zinc-700 text-zinc-900 dark:text-zinc-100 focus:ring-2 focus:ring-green-500 focus:border-transparent",disabled:!1,children:[(0,t.jsx)("option",{value:"",children:"Selecione um ecoponto"}),f.map(e=>(0,t.jsx)("option",{value:e,children:e},e))]}),!1]})]}),(0,t.jsxs)("div",{className:"bg-white dark:bg-zinc-800 rounded-xl shadow-lg p-6",children:[(0,t.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,t.jsx)("h2",{className:"text-xl font-semibold text-zinc-900 dark:text-zinc-100",children:"Fotos do Ecoponto"}),(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsxs)("span",{className:"text-sm text-zinc-600 dark:text-zinc-400",children:[g.length,"/10 fotos"]}),(0,t.jsxs)("button",{onClick:function(){let e=document.createElement("input");e.type="file",e.accept="image/*",e.multiple=!0,e.onchange=e=>{let r=e.target.files;if(r&&r.length>0){let e=Array.from(r);if(g.length+e.length>10)return void c.oR.error("M\xe1ximo de 10 fotos. Voc\xea j\xe1 tem ".concat(g.length," foto(s)."));e.forEach((e,r)=>{!function(e,r){if(e.size>0xa00000)return c.oR.error("Arquivo muito grande. M\xe1ximo 10MB.");(function(e){let r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:800,o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:.8;return new Promise(t=>{let a=document.createElement("canvas"),s=a.getContext("2d"),i=new Image;i.onload=()=>{let{width:e,height:n}=i;e>r&&(n=n*r/e,e=r),a.width=e,a.height=n,null==s||s.drawImage(i,0,0,e,n),t(a.toDataURL("image/jpeg",o))},i.src=URL.createObjectURL(e)})})(e).then(r)}(e,e=>{x(r=>[...r,e])})})}},e.click()},className:"px-4 py-2 bg-green-600 hover:bg-green-500 text-white rounded-lg flex items-center gap-2 transition-colors duration-200",children:[(0,t.jsx)("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,t.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 6v6m0 0v6m0-6h6m-6 0H6"})}),"Adicionar Fotos"]})]})]}),g.length>0&&(0,t.jsx)("div",{className:"grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-4",children:g.map((e,r)=>(0,t.jsxs)("div",{className:"relative group",children:[(0,t.jsx)("img",{src:e,alt:"Ecoponto - Foto ".concat(r+1),className:"w-full h-32 object-cover rounded-lg border border-zinc-300 dark:border-zinc-600"}),(0,t.jsx)("button",{onClick:()=>{x(e=>e.filter((e,o)=>o!==r))},className:"absolute -top-2 -right-2 bg-red-600 hover:bg-red-500 text-white rounded-full w-6 h-6 flex items-center justify-center text-sm opacity-0 group-hover:opacity-100 transition-opacity duration-200",children:"\xd7"}),(0,t.jsx)("div",{className:"absolute bottom-0 left-0 right-0 bg-black/70 text-white text-xs p-2 rounded-b-lg",children:m||"Foto ".concat(r+1)})]},r))}),0===g.length&&(0,t.jsxs)("div",{className:"text-center py-8 text-zinc-500 dark:text-zinc-400",children:[(0,t.jsx)("svg",{className:"w-12 h-12 mx-auto mb-4 opacity-50",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,t.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"})}),(0,t.jsx)("p",{children:"Nenhuma foto adicionada ainda"}),(0,t.jsx)("p",{className:"text-sm",children:'Clique em "Adicionar Fotos" para come\xe7ar'})]})]}),(0,t.jsxs)("div",{className:"flex gap-3 justify-end",children:[(0,t.jsx)("button",{onClick:()=>window.history.back(),className:"px-6 py-3 bg-zinc-600 hover:bg-zinc-500 text-white rounded-lg transition-colors duration-200",children:"Cancelar"}),(0,t.jsxs)("button",{onClick:p,className:"px-6 py-3 bg-green-600 hover:bg-green-500 text-white rounded-lg flex items-center gap-2 transition-colors duration-200",children:[(0,t.jsx)("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,t.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M5 13l4 4L19 7"})}),"Salvar Relat\xf3rio"]})]})]})})})}},6020:(e,r,o)=>{"use strict";o.d(r,{DZ:()=>s,ZU:()=>i,iU:()=>t,k4:()=>a,zb:()=>n});let t={SP:"S\xc3O PAULO",CV:"CASA VERDE / LIM\xc3O / CACHOEIRINHA",JT:"JA\xc7AN\xc3 / TREMEMB\xc9",MG:"VILA MARIA / VILA GUILHERME",ST:"SANTANA / TUCURUVI"},a={MUTIRAO:"Mutir\xe3o - SELIMP",REVITALIZACAO:"Revitaliza\xe7\xe3o de Pontos Viciados",ACUMULADOR:"A\xe7\xe3o de Acumulador",ALAGAMENTOS:"Limpeza P\xf3s Alagamento",ZELADORIA:"Zeladoria",DDS:"DDS",HIGIENIZACAO:"Higieniza\xe7\xe3o, manuten\xe7\xe3o, instala\xe7\xe3o, remo\xe7\xe3o e reposi\xe7\xe3o de Papeleiras",VARRICAO_MECANIZADA:"Varri\xe7\xe3o Mecanizada",FEIRAS:"Feiras",EVENTOS:"Eventos",ROTINEIROS:"Servi\xe7os Rotineiros"},s=["Acumulador","Alagamentos","Zeladoria"],i=["Capina\xe7\xe3o e Ro\xe7agem","Cata Bagulho","Coleta manual e transporte de materiais diversos/entulho","Coleta mecanizada e transporte de materiais diversos e de entulho","Grandes Objetos - Coleta e transporte de objetos volumosos","Higieniza\xe7\xe3o, manuten\xe7\xe3o, instala\xe7\xe3o, remo\xe7\xe3o e reposi\xe7\xe3o de Papeleiras","Lavagem Especial de Equipamentos P\xfablicos","Limpeza de Boca de Lobo","Mutir\xe3o","Raspagem da terra e areia nas sarjetas de vias p\xfablicas","Remo\xe7\xe3o de faixas e propagandas irregulares","Servi\xe7o de pintura de meio fio","Varri\xe7\xe3o Manual de Vias e Logradouros Publicos","Varri\xe7\xe3o Mecanizada","Desfazimento","Varri\xe7\xe3o de Pra\xe7a","Feiras","Ecopontos"],n={CV:["Ecoponto Vila Nova Cachoeirinha","Ecoponto Vila Santa Maria","Ecoponto Parque Peruche","Ecoponto Jardim Ant\xe1rtica","Ecoponto S\xe3o Leandro"],MG:["Ecoponto Vila Sabrina","Ecoponto Vila Guilherme","Ecoponto Vila Maria"],ST:["Ecoponto Santana","Ecoponto Tucuruvi"],JT:["Ecoponto Anselmo Machado","Ecoponto Silvio Bittencourt"]}},7990:(e,r,o)=>{Promise.resolve().then(o.bind(o,5525))},8209:(e,r,o)=>{"use strict";o.d(r,{A:()=>i,Y:()=>n});var t=o(2115),a=o(3361);let s={"marcos.silva":"marcos.silva@limpebras.com",admin:"admin@test.com","admin@test.com":"admin@test.com",usuario1:"usuario1@limpebras.com",usuario2:"usuario2@limpebras.com"};function i(){let[e,r]=(0,t.useState)({isAuthenticated:!1,user:null,isLoading:!0,login:async()=>!1,logout:()=>{},isAdmin:!1});(0,t.useEffect)(()=>{localStorage.getItem("auth_token")?(a.y1.initToken(),a.y1.getProfile().then(e=>{r(r=>({...r,isAuthenticated:!0,user:{id:e.id,nome:e.nome,email:e.email,username:e.email.split("@")[0],role:e.role,created_at:e.created_at},isLoading:!1,isAdmin:"admin"===e.role}))}).catch(e=>{console.error("Token inv\xe1lido:",e),localStorage.removeItem("auth_token"),r(e=>({...e,isAuthenticated:!1,user:null,isLoading:!1,isAdmin:!1}))})):r(e=>({...e,isAuthenticated:!1,user:null,isLoading:!1,isAdmin:!1}))},[]);let o=async(e,o)=>{try{let t=s[e]||e,i=await a.y1.login(t,o);if(i.token&&i.user)return r(r=>({...r,isAuthenticated:!0,user:{id:i.user.id,nome:i.user.nome,email:i.user.email,username:e,role:i.user.role},isLoading:!1,isAdmin:"admin"===i.user.role})),console.log("Login successful, user authenticated:",i.user),!0;return console.log("Login failed - invalid response"),!1}catch(e){return console.error("Erro no login:",e),!1}};return{...e,login:o,logout:()=>{a.y1.logout(),r(e=>({...e,isAuthenticated:!1,user:null,isLoading:!1,isAdmin:!1}))},isAdmin:e.isAdmin}}function n(){let[e,r]=(0,t.useState)([]),[o,s]=(0,t.useState)(!1),i=async()=>{try{s(!0),r([])}catch(e){console.error("Erro ao carregar usu\xe1rios:",e)}finally{s(!1)}};return(0,t.useEffect)(()=>{i()},[]),{users:e,loading:o,addUser:async e=>{try{let r=await a.y1.register(e);return await i(),r.user}catch(e){throw console.error("Erro ao adicionar usu\xe1rio:",e),e}},updateUser:async(e,r)=>{try{await a.y1.updateProfile(r),await i()}catch(e){throw console.error("Erro ao atualizar usu\xe1rio:",e),e}},deleteUser:async e=>{try{await i()}catch(e){throw console.error("Erro ao deletar usu\xe1rio:",e),e}},toggleUserStatus:async e=>{try{await i()}catch(e){throw console.error("Erro ao alterar status do usu\xe1rio:",e),e}},refreshUsers:i}}},9675:(e,r,o)=>{"use strict";let t;o.d(r,{A:()=>n});let a={randomUUID:"undefined"!=typeof crypto&&crypto.randomUUID&&crypto.randomUUID.bind(crypto)},s=new Uint8Array(16),i=[];for(let e=0;e<256;++e)i.push((e+256).toString(16).slice(1));let n=function(e,r,o){if(a.randomUUID&&!r&&!e)return a.randomUUID();var n=e,l=o;let c=(n=n||{}).random??n.rng?.()??function(){if(!t){if("undefined"==typeof crypto||!crypto.getRandomValues)throw Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");t=crypto.getRandomValues.bind(crypto)}return t(s)}();if(c.length<16)throw Error("Random bytes length must be >= 16");if(c[6]=15&c[6]|64,c[8]=63&c[8]|128,r){if((l=l||0)<0||l+16>r.length)throw RangeError(`UUID byte range ${l}:${l+15} is out of buffer bounds`);for(let e=0;e<16;++e)r[l+e]=c[e];return r}return function(e,r=0){return(i[e[r+0]]+i[e[r+1]]+i[e[r+2]]+i[e[r+3]]+"-"+i[e[r+4]]+i[e[r+5]]+"-"+i[e[r+6]]+i[e[r+7]]+"-"+i[e[r+8]]+i[e[r+9]]+"-"+i[e[r+10]]+i[e[r+11]]+i[e[r+12]]+i[e[r+13]]+i[e[r+14]]+i[e[r+15]]).toLowerCase()}(c)}}},e=>{e.O(0,[4744,3372,8441,1255,7358],()=>e(e.s=7990)),_N_E=e.O()}]);