(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[8656],{63:(e,t,r)=>{"use strict";var o=r(7260);r.o(o,"usePathname")&&r.d(t,{usePathname:function(){return o.usePathname}}),r.o(o,"useRouter")&&r.d(t,{useRouter:function(){return o.useRouter}})},3156:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>d});var o=r(5155),s=r(2115),a=r(3372),n=r(9675),i=r(9767),l=r(4589),c=r(4744);function d(){let[e,t]=(0,s.useState)("DDS"),[r,d]=(0,s.useState)(null),[u,m]=(0,s.useState)(null),[h,x]=(0,s.useState)(""),[g,p]=(0,s.useState)(""),[b,f]=(0,s.useState)([]),[v,j]=(0,s.useState)([{ordem:1,descricao:""}]),[k,y]=(0,s.useState)({});async function w(){if(!r||!u)return void c.oR.error("Por favor, selecione o per\xedodo do DDS.");let t=Date.now(),o=(0,n.A)(),s=Object.entries(k).flatMap(e=>{var t;let[r,o]=e,s=parseInt(r.replace("setor_","")),a=(null==(t=v[s])?void 0:t.descricao)||"Setor ".concat(s+1);return o.map((e,t)=>({url:e,descricao:a,ordem:t+1}))});console.log("Fotos dos servi\xe7os:",k),console.log("Fotos processadas:",s);let i=r.toISOString().split("T")[0],l=u.toISOString().split("T")[0],d={id:o,tipoServico:"DDS",assunto:e||"DDS",data:"".concat(i," a ").concat(l),dataInicio:i,dataTermino:l,sub:"SP",local:h||"",descricao:g||"",fotos:s,createdAt:t,updatedAt:t};console.log("Relat\xf3rio DDS a ser salvo:",d);try{await (0,a.wt)(d),c.oR.success("Relat\xf3rio DDS salvo com sucesso!"),window.location.href="/relatorios"}catch(e){console.error("Erro ao salvar relat\xf3rio DDS:",e),c.oR.error("Erro ao salvar. Tentando limpar relat\xf3rios antigos..."),await (0,a.gI)();try{await (0,a.wt)(d),c.oR.success("Relat\xf3rio DDS salvo com sucesso!"),window.location.href="/relatorios"}catch(e){c.oR.error("Erro persistente. Por favor, tente novamente com menos fotos."),console.error("Erro persistente:",e)}}}return(0,o.jsx)(l.K,{requiredRole:"admin",children:(0,o.jsxs)("div",{className:"space-y-6",children:[(0,o.jsx)("div",{className:"bg-gradient-to-r from-purple-500 to-pink-600 rounded-xl p-6 text-white shadow-lg",children:(0,o.jsxs)("div",{className:"flex items-center gap-3",children:[(0,o.jsx)("div",{className:"p-3 bg-white/20 rounded-lg",children:(0,o.jsx)("svg",{className:"w-8 h-8",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,o.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"})})}),(0,o.jsxs)("div",{children:[(0,o.jsx)("h1",{className:"text-2xl font-bold",children:"\uD83D\uDCCB Novo Relat\xf3rio DDS"}),(0,o.jsx)("p",{className:"text-purple-100",children:"Registre as atividades mensais de DDS dos setores"})]})]})}),(0,o.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,o.jsxs)("div",{className:"flex flex-col gap-1",children:[(0,o.jsx)("label",{className:"text-xs text-zinc-600 dark:text-zinc-400",children:"Tipo de Servi\xe7o"}),(0,o.jsx)("select",{value:e,disabled:!0,className:"bg-zinc-700 text-zinc-300 px-3 py-2 rounded border border-zinc-600 cursor-not-allowed font-semibold",children:(0,o.jsx)("option",{value:"DDS",children:"DDS"})})]}),(0,o.jsxs)("div",{className:"flex flex-col gap-1",children:[(0,o.jsx)("label",{className:"text-xs text-black dark:text-zinc-400 font-bold",children:"Per\xedodo"}),(0,o.jsx)(i.U,{startDate:r,endDate:u,onStartDateChange:d,onEndDateChange:m,placeholder:"Selecione o per\xedodo do DDS"})]}),(0,o.jsxs)("div",{className:"flex flex-col gap-1",children:[(0,o.jsx)("label",{className:"text-xs text-black dark:text-zinc-400 font-bold",children:"Sub-regi\xe3o"}),(0,o.jsx)("select",{value:"SP",disabled:!0,className:"bg-zinc-700 text-zinc-300 px-3 py-2 rounded border border-zinc-600 cursor-not-allowed font-semibold",children:(0,o.jsx)("option",{value:"SP",children:"S\xc3O PAULO"})})]})]}),(0,o.jsxs)("section",{className:"space-y-3",children:[(0,o.jsx)("h2",{className:"font-medium",children:"INFORMA\xc7\xd5ES (sub)"}),(0,o.jsx)("div",{className:"space-y-2",children:v.map((e,t)=>{let r=k["setor_".concat(t)]||[],s=r.length,a=s>0;return(0,o.jsxs)("div",{className:"bg-zinc-100 dark:bg-zinc-900 border border-zinc-200 dark:border-zinc-800 rounded-lg p-4",children:[(0,o.jsxs)("div",{className:"flex items-center gap-3 mb-3",children:[(0,o.jsxs)("span",{className:"w-10 text-zinc-400 font-semibold",children:[e.ordem,"."]}),(0,o.jsx)("input",{value:e.descricao,onChange:e=>{let r=e.target.value;j(e=>{let o=[...e];return o[t]={...o[t],descricao:r},o})},className:"flex-1 bg-zinc-200 dark:bg-zinc-800 text-zinc-900 dark:text-zinc-100 px-3 py-2 rounded border border-zinc-300 dark:border-zinc-700 font-semibold transition-all duration-200 focus:border-zinc-500 dark:focus:border-zinc-500 focus:ring-2 focus:ring-zinc-200 dark:focus:ring-zinc-700 focus:shadow-md",placeholder:"Descri\xe7\xe3o do setor/servi\xe7o"}),(0,o.jsxs)("span",{className:"text-xs px-2 py-1 rounded-full ".concat(a?"bg-green-100 dark:bg-green-900 text-green-800 dark:text-green-200":"bg-zinc-100 dark:bg-zinc-700 text-zinc-600 dark:text-zinc-400"),children:[s," fotos"]})]}),(0,o.jsxs)("div",{className:"space-y-3",children:[(0,o.jsxs)("div",{className:"relative",children:[(0,o.jsx)("input",{type:"file",accept:"image/*",multiple:!0,onChange:e=>{let r=e.target.files;r&&r.length>0&&Array.from(r).forEach(e=>{(function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:800,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:.8;return new Promise(o=>{let s=document.createElement("canvas"),a=s.getContext("2d"),n=new Image;n.onload=()=>{let{width:i,height:l}=n;i>t&&(l=l*t/i,i=t),s.width=i,s.height=l,null==a||a.drawImage(n,0,0,i,l);let c=s.toDataURL("image/jpeg",r);console.log("\uD83D\uDCF8 Imagem comprimida: ".concat(e.size," bytes â†’ ").concat(c.length," bytes")),o(c)},n.src=URL.createObjectURL(e)})})(e,800,.8).then(e=>{y(r=>({...r,["setor_".concat(t)]:[...r["setor_".concat(t)]||[],e]}))})})},className:"hidden",id:"upload-".concat(e.descricao,"-").concat(t)}),(0,o.jsx)("button",{type:"button",onClick:()=>{var r;return null==(r=document.getElementById("upload-".concat(e.descricao,"-").concat(t)))?void 0:r.click()},className:"flex items-center justify-center w-full h-16 border-2 border-dashed border-zinc-300 dark:border-zinc-600 rounded-lg cursor-pointer bg-zinc-100 dark:bg-zinc-800 hover:bg-zinc-200 dark:hover:bg-zinc-750 hover:border-indigo-500 transition-colors",children:(0,o.jsxs)("div",{className:"flex items-center gap-2",children:[(0,o.jsx)("svg",{className:"w-6 h-6 text-zinc-500 dark:text-zinc-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,o.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12"})}),(0,o.jsx)("span",{className:"text-sm text-zinc-600 dark:text-zinc-400 font-medium",children:"\uD83D\uDCF8 Adicionar Fotos (m\xfaltiplas)"})]})})]}),a&&(0,o.jsx)("div",{className:"grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-3",children:r.map((r,s)=>(0,o.jsxs)("div",{className:"relative group",children:[(0,o.jsx)("div",{className:"w-full h-32 border border-zinc-300 dark:border-zinc-600 rounded overflow-hidden",children:(0,o.jsx)("img",{src:r,alt:"".concat(e.descricao," - ").concat(s+1),className:"w-full h-full object-contain"})}),(0,o.jsx)("button",{type:"button",onClick:()=>{y(e=>{var r;return{...e,["setor_".concat(t)]:(null==(r=e["setor_".concat(t)])?void 0:r.filter((e,t)=>t!==s))||[]}})},className:"absolute top-1 right-1 w-6 h-6 bg-red-600 hover:bg-red-500 text-white rounded-full text-xs opacity-0 group-hover:opacity-100 transition-opacity flex items-center justify-center",children:"\xd7"}),(0,o.jsx)("div",{className:"absolute bottom-1 left-1 bg-black/70 text-white text-xs px-1 rounded",children:s+1})]},s))})]})]},t)})}),(0,o.jsx)("button",{onClick:function(){j(e=>[...e,{ordem:e.length+1,descricao:""}])},className:"p-2 bg-blue-100 hover:bg-blue-200 dark:bg-blue-600 dark:hover:bg-blue-500 text-blue-600 dark:text-white rounded-lg transition-colors duration-200 flex items-center justify-center",title:"Adicionar linha",children:(0,o.jsx)("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,o.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 6v6m0 0v6m0-6h6m-6 0H6"})})})]}),(0,o.jsxs)("div",{className:"pt-2 flex gap-3",children:[(0,o.jsxs)("button",{onClick:w,className:"bg-indigo-600 hover:bg-indigo-500 text-white px-4 py-2 rounded flex items-center gap-2",children:[(0,o.jsx)("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,o.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M5 13l4 4L19 7"})}),"\uD83D\uDCBE Salvar"]}),(0,o.jsx)("button",{onClick:()=>window.history.back(),className:"bg-zinc-600 hover:bg-zinc-500 text-white px-4 py-2 rounded",children:"Voltar"})]})]})})}},4589:(e,t,r)=>{"use strict";r.d(t,{K:()=>i});var o=r(5155),s=r(8209),a=r(63),n=r(2115);function i(e){let{children:t,requiredRole:r="user",fallbackPath:i="/relatorios"}=e,{isAuthenticated:l,isAdmin:c,isLoading:d}=(0,s.A)(),u=(0,a.useRouter)();if((0,n.useEffect)(()=>{if(!d&&l){let e=!1;switch(r){case"host":case"admin":e=c;break;case"user":e=!0}e||u.push(i)}},[l,c,d,r,i,u]),d)return(0,o.jsx)("div",{className:"min-h-screen bg-gradient-to-br from-slate-50 to-blue-50 dark:from-slate-900 dark:to-blue-900 flex items-center justify-center",children:(0,o.jsxs)("div",{className:"text-center",children:[(0,o.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto mb-4"}),(0,o.jsx)("p",{className:"text-slate-600 dark:text-slate-400",children:"Verificando permiss\xf5es..."})]})});if(!l)return null;let m=!1;switch(r){case"host":case"admin":m=c;break;case"user":m=!0}return m?(0,o.jsx)(o.Fragment,{children:t}):(0,o.jsx)("div",{className:"min-h-screen bg-gradient-to-br from-slate-50 to-blue-50 dark:from-slate-900 dark:to-blue-900 flex items-center justify-center",children:(0,o.jsxs)("div",{className:"text-center bg-white dark:bg-slate-800 p-8 rounded-xl shadow-lg",children:[(0,o.jsx)("div",{className:"text-red-500 text-6xl mb-4",children:"\uD83D\uDEAB"}),(0,o.jsx)("h1",{className:"text-2xl font-bold text-slate-800 dark:text-slate-200 mb-2",children:"Acesso Negado"}),(0,o.jsx)("p",{className:"text-slate-600 dark:text-slate-400 mb-6",children:"Voc\xea n\xe3o tem permiss\xe3o para acessar esta p\xe1gina."}),(0,o.jsx)("button",{onClick:()=>u.push(i),className:"bg-blue-600 hover:bg-blue-700 text-white px-6 py-3 rounded-lg font-semibold transition-colors duration-200",children:"Voltar ao In\xedcio"})]})})}},4881:(e,t,r)=>{Promise.resolve().then(r.bind(r,3156))},8209:(e,t,r)=>{"use strict";r.d(t,{A:()=>n,Y:()=>i});var o=r(2115),s=r(3361);let a={"marcos.silva":"marcos.silva@limpebras.com",admin:"admin@test.com","admin@test.com":"admin@test.com",usuario1:"usuario1@limpebras.com",usuario2:"usuario2@limpebras.com"};function n(){let[e,t]=(0,o.useState)({isAuthenticated:!1,user:null,isLoading:!0,login:async()=>!1,logout:()=>{},isAdmin:!1});(0,o.useEffect)(()=>{localStorage.getItem("auth_token")?(s.y1.initToken(),s.y1.getProfile().then(e=>{t(t=>({...t,isAuthenticated:!0,user:{id:e.id,nome:e.nome,email:e.email,username:e.email.split("@")[0],role:e.role,created_at:e.created_at},isLoading:!1,isAdmin:"admin"===e.role}))}).catch(e=>{console.error("Token inv\xe1lido:",e),localStorage.removeItem("auth_token"),t(e=>({...e,isAuthenticated:!1,user:null,isLoading:!1,isAdmin:!1}))})):t(e=>({...e,isAuthenticated:!1,user:null,isLoading:!1,isAdmin:!1}))},[]);let r=async(e,r)=>{try{let o=a[e]||e,n=await s.y1.login(o,r);if(n.token&&n.user)return t(t=>({...t,isAuthenticated:!0,user:{id:n.user.id,nome:n.user.nome,email:n.user.email,username:e,role:n.user.role},isLoading:!1,isAdmin:"admin"===n.user.role})),console.log("Login successful, user authenticated:",n.user),!0;return console.log("Login failed - invalid response"),!1}catch(e){return console.error("Erro no login:",e),!1}};return{...e,login:r,logout:()=>{s.y1.logout(),t(e=>({...e,isAuthenticated:!1,user:null,isLoading:!1,isAdmin:!1}))},isAdmin:e.isAdmin}}function i(){let[e,t]=(0,o.useState)([]),[r,a]=(0,o.useState)(!1),n=async()=>{try{a(!0),t([])}catch(e){console.error("Erro ao carregar usu\xe1rios:",e)}finally{a(!1)}};return(0,o.useEffect)(()=>{n()},[]),{users:e,loading:r,addUser:async e=>{try{let t=await s.y1.register(e);return await n(),t.user}catch(e){throw console.error("Erro ao adicionar usu\xe1rio:",e),e}},updateUser:async(e,t)=>{try{await s.y1.updateProfile(t),await n()}catch(e){throw console.error("Erro ao atualizar usu\xe1rio:",e),e}},deleteUser:async e=>{try{await n()}catch(e){throw console.error("Erro ao deletar usu\xe1rio:",e),e}},toggleUserStatus:async e=>{try{await n()}catch(e){throw console.error("Erro ao alterar status do usu\xe1rio:",e),e}},refreshUsers:n}}},9675:(e,t,r)=>{"use strict";let o;r.d(t,{A:()=>i});let s={randomUUID:"undefined"!=typeof crypto&&crypto.randomUUID&&crypto.randomUUID.bind(crypto)},a=new Uint8Array(16),n=[];for(let e=0;e<256;++e)n.push((e+256).toString(16).slice(1));let i=function(e,t,r){if(s.randomUUID&&!t&&!e)return s.randomUUID();var i=e,l=r;let c=(i=i||{}).random??i.rng?.()??function(){if(!o){if("undefined"==typeof crypto||!crypto.getRandomValues)throw Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");o=crypto.getRandomValues.bind(crypto)}return o(a)}();if(c.length<16)throw Error("Random bytes length must be >= 16");if(c[6]=15&c[6]|64,c[8]=63&c[8]|128,t){if((l=l||0)<0||l+16>t.length)throw RangeError(`UUID byte range ${l}:${l+15} is out of buffer bounds`);for(let e=0;e<16;++e)t[l+e]=c[e];return t}return function(e,t=0){return(n[e[t+0]]+n[e[t+1]]+n[e[t+2]]+n[e[t+3]]+"-"+n[e[t+4]]+n[e[t+5]]+"-"+n[e[t+6]]+n[e[t+7]]+"-"+n[e[t+8]]+n[e[t+9]]+"-"+n[e[t+10]]+n[e[t+11]]+n[e[t+12]]+n[e[t+13]]+n[e[t+14]]+n[e[t+15]]).toLowerCase()}(c)}},9767:(e,t,r)=>{"use strict";r.d(t,{U:()=>n});var o=r(5155),s=r(2115),a=r(740);function n(e){let{startDate:t,endDate:r,onStartDateChange:n,onEndDateChange:i,placeholder:l="Selecione o per\xedodo",className:c=""}=e,[d,u]=(0,s.useState)(!1);return(0,o.jsxs)("div",{className:"relative ".concat(c),children:[(0,o.jsxs)("button",{type:"button",onClick:()=>u(!d),className:"w-full bg-zinc-800 text-zinc-100 px-3 py-2 rounded border border-zinc-700 text-left flex items-center justify-between",children:[(0,o.jsx)("span",{className:t||r?"text-zinc-100":"text-zinc-400",children:t||r?t&&!r?t.toLocaleDateString("pt-BR"):!t&&r?r.toLocaleDateString("pt-BR"):t&&r?t.getTime()===r.getTime()?t.toLocaleDateString("pt-BR"):"".concat(t.toLocaleDateString("pt-BR")," a ").concat(r.toLocaleDateString("pt-BR")):l:l}),(0,o.jsx)("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,o.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"})})]}),d&&(0,o.jsxs)("div",{className:"absolute top-full left-0 mt-1 bg-zinc-800 border border-zinc-700 rounded shadow-lg z-50 p-4",children:[(0,o.jsx)(a.Ay,{selected:t,onChange:e=>{let[t,r]=e;n(t),i(r)},startDate:t,endDate:r,selectsRange:!0,inline:!0,dateFormat:"dd/MM/yyyy"}),(0,o.jsxs)("div",{className:"flex gap-2 pt-2",children:[(0,o.jsx)("button",{onClick:()=>{n(null),i(null)},className:"text-xs text-zinc-400 hover:text-zinc-300",children:"Limpar"}),(0,o.jsx)("button",{onClick:()=>u(!1),className:"text-xs bg-indigo-600 hover:bg-indigo-500 text-white px-3 py-1 rounded",children:"Confirmar"})]})]})]})}r(9157)}},e=>{e.O(0,[3038,5579,4020,4744,1061,3372,8441,1255,7358],()=>e(e.s=4881)),_N_E=e.O()}]);